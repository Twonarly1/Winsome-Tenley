var Nn=Object.create;var nr=Object.defineProperty,Bn=Object.defineProperties,Mn=Object.getOwnPropertyDescriptor,Ln=Object.getOwnPropertyDescriptors,Un=Object.getOwnPropertyNames,Qa=Object.getOwnPropertySymbols,$n=Object.getPrototypeOf,Ya=Object.prototype.hasOwnProperty,Vn=Object.prototype.propertyIsEnumerable;var Qe=(o,t,r)=>t in o?nr(o,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):o[t]=r,S=(o,t)=>{for(var r in t||(t={}))Ya.call(t,r)&&Qe(o,r,t[r]);if(Qa)for(var r of Qa(t))Vn.call(t,r)&&Qe(o,r,t[r]);return o},O=(o,t)=>Bn(o,Ln(t)),c=(o,t)=>nr(o,"name",{value:t,configurable:!0});var Gn=(o,t)=>{for(var r in t)nr(o,r,{get:t[r],enumerable:!0})},Xa=(o,t,r,e)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Un(t))!Ya.call(o,a)&&a!==r&&nr(o,a,{get:()=>t[a],enumerable:!(e=Mn(t,a))||e.enumerable});return o};var tt=(o,t,r)=>(r=o!=null?Nn($n(o)):{},Xa(t||!o||!o.__esModule?nr(r,"default",{value:o,enumerable:!0}):r,o)),jn=o=>Xa(nr({},"__esModule",{value:!0}),o);var f=(o,t,r)=>(Qe(o,typeof t!="symbol"?t+"":t,r),r);var Ms={};Gn(Ms,{ALL_ROLES:()=>Xe,AdminRoleMissingError:()=>ca,AssetNotFoundError:()=>ra,AuctionAlreadyStartedError:()=>Fr,AuctionHasNotEndedError:()=>Ir,BaseSignaturePayloadInput:()=>ya,CONTRACTS_MAP:()=>pe,CONTRACT_ADDRESSES:()=>be,ChainId:()=>h,ChainlinkVrf:()=>fr,ClaimConditionInputArray:()=>ha,ClaimConditionInputSchema:()=>pr,ClaimConditionOutputSchema:()=>ye,ClaimEligibility:()=>A,CommonContractOutputSchema:()=>k,CommonContractSchema:()=>v,CommonPlatformFeeSchema:()=>P,CommonPrimarySaleSchema:()=>st,CommonRoyaltySchema:()=>x,CommonSymbolSchema:()=>L,CommonTrustedForwarderSchema:()=>R,ContractDeployer:()=>me,ContractEncoder:()=>E,ContractEvents:()=>F,ContractInterceptor:()=>tr,ContractMetadata:()=>b,ContractPrimarySale:()=>it,ContractRoles:()=>N,ContractRoyalty:()=>rt,CurrencySchema:()=>po,CurrencyValueSchema:()=>ua,CustomContract:()=>or,DEFAULT_IPFS_GATEWAY:()=>Pa,DEFAULT_QUERY_ALL_COUNT:()=>wr,DelayedReveal:()=>ie,DropErc1155ClaimConditions:()=>Vr,DropErc1155History:()=>Gr,DropErc721ClaimConditions:()=>Ur,DuplicateFileNameError:()=>Er,DuplicateLeafsError:()=>Rr,Edition:()=>J,EditionDrop:()=>_,EditionMetadataInputOrUriSchema:()=>Fs,EditionMetadataInputSchema:()=>Rs,EditionMetadataOutputSchema:()=>Ie,EditionMetadataWithOwnerOutputSchema:()=>ks,Erc1155:()=>Xt,Erc1155SignatureMinting:()=>Jr,Erc20:()=>Hr,Erc20SignatureMinting:()=>qr,Erc721:()=>Yt,Erc721SignatureMinting:()=>Kr,EventType:()=>ft,FetchError:()=>kr,FileNameMissingError:()=>ea,FunctionDeprecatedError:()=>sa,GasCostEstimator:()=>I,InterfaceId_IERC1155:()=>Mt,InterfaceId_IERC721:()=>Bt,InvalidAddressError:()=>ta,IpfsStorage:()=>le,ListingNotFoundError:()=>wt,ListingType:()=>$,Marketplace:()=>G,MarketplaceAuction:()=>Yr,MarketplaceDirect:()=>Qr,MerkleSchema:()=>Ct,MintRequest1155:()=>ba,MintRequest20:()=>Ta,MintRequest721:()=>Wa,MissingOwnerRoleError:()=>oa,MissingRoleError:()=>xr,NATIVE_TOKENS:()=>co,NATIVE_TOKEN_ADDRESS:()=>xt,NFTCollection:()=>K,NFTDrop:()=>H,NotEnoughTokensError:()=>aa,NotFoundError:()=>ut,OZ_DEFENDER_FORWARDER_ADDRESS:()=>dr,OptionalPropertiesInput:()=>fa,OptionalPropertiesOutput:()=>ga,PINATA_IPFS_URL:()=>ka,Pack:()=>j,PartialClaimConditionInputSchema:()=>qn,ProposalState:()=>Fa,QuantityAboveLimitError:()=>na,REMOTE_CONTRACT_NAME:()=>Za,REMOTE_CONTRACT_TO_CONTRACT_TYPE:()=>ze,RestrictedTransferError:()=>ia,SUPPORTED_CHAIN_IDS:()=>ma,Signature1155PayloadInput:()=>Ca,Signature1155PayloadOutput:()=>Sa,Signature20PayloadInput:()=>Te,Signature20PayloadOutput:()=>wa,Signature721PayloadInput:()=>Dr,Signature721PayloadOutput:()=>We,SnapshotAddress:()=>ge,SnapshotInfoSchema:()=>Zn,SnapshotInputSchema:()=>zt,SnapshotSchema:()=>ir,Split:()=>Y,TW_IPFS_SERVER_URL:()=>Ea,ThirdwebSDK:()=>Ja,Token:()=>V,TokenERC20History:()=>zr,TokenMintInputSchema:()=>Is,TransactionError:()=>ue,UnderlyingType:()=>La,UploadError:()=>Pr,Vote:()=>Q,VoteType:()=>qt,WrongListingTypeError:()=>jt,convertToTWError:()=>pa,createSnapshot:()=>Ra,getContractAddressByChainId:()=>mr,getNativeTokenByChainId:()=>la,getRoleHash:()=>D,hashLeafNode:()=>vo});module.exports=jn(Ms);var hu=require("cross-fetch/polyfill");var E=class{constructor(t){this.contractWrapper=t}encode(t,r){return this.contractWrapper.readContract.interface.encodeFunctionData(t,r)}decode(t,r){return this.contractWrapper.readContract.interface.decodeFunctionData(t,r)}};c(E,"ContractEncoder");var b=class{constructor(t,r,e){this.contractWrapper=t,this.schema=r,this.storage=e}parseOutputMetadata(t){return this.schema.output.parse(t)}parseInputMetadata(t){return this.schema.input.parse(t)}async get(){let t=await this.contractWrapper.readContract.contractURI(),r=await this.storage.get(t);return this.parseOutputMetadata(r)}async set(t){let r=await this._parseAndUploadMetadata(t);return{receipt:await this.contractWrapper.sendTransaction("setContractURI",[r]),data:this.get}}async update(t){return await this.set(S(S({},await this.get()),t))}async _parseAndUploadMetadata(t){let r=this.parseInputMetadata(t);return this.storage.uploadMetadata(r)}};c(b,"ContractMetadata");var Ye=require("ethers"),to={admin:"",transfer:"TRANSFER_ROLE",minter:"MINTER_ROLE",pauser:"PAUSER_ROLE",editor:"EDITOR_ROLE",lister:"LISTER_ROLE",asset:"ASSET_ROLE"},Xe=Object.keys(to);function D(o){return o==="admin"?Ye.ethers.utils.hexZeroPad([0],32):Ye.ethers.utils.id(to[o])}c(D,"getRoleHash");var Ht=tt(require("tiny-invariant"));var ut=class extends Error{constructor(t){super(t?`Object with id ${t} NOT FOUND`:"NOT_FOUND")}};c(ut,"NotFoundError");var ta=class extends Error{constructor(t){super(t?`'${t}' is an invalid address`:"Invalid address passed")}};c(ta,"InvalidAddressError");var xr=class extends Error{constructor(t,r){super(`MISSING ROLE: ${t} does not have the '${r}' role`)}};c(xr,"MissingRoleError");var ra=class extends Error{constructor(t="The asset you're trying to use could not be found."){super(`message: ${t}`)}};c(ra,"AssetNotFoundError");var Pr=class extends Error{constructor(t){super(`UPLOAD_FAILED: ${t}`)}};c(Pr,"UploadError");var ea=class extends Error{constructor(){super("File name is required when object is not a `File` type object.")}};c(ea,"FileNameMissingError");var Er=class extends Error{constructor(t){super(`DUPLICATE_FILE_NAME_ERROR: File name ${t} was passed for more than one file.`)}};c(Er,"DuplicateFileNameError");var aa=class extends Error{constructor(t,r,e){super(`BALANCE ERROR: you do not have enough balance on contract ${t} to use ${r} tokens. You have ${e} tokens available.`)}};c(aa,"NotEnoughTokensError");var oa=class extends Error{constructor(){super("LIST ERROR: you should be the owner of the token to list it.")}};c(oa,"MissingOwnerRoleError");var na=class extends Error{constructor(t){super(`BUY ERROR: You cannot buy more than ${t} tokens`)}};c(na,"QuantityAboveLimitError");var kr=class extends Error{constructor(t,r){super(`FETCH_FAILED: ${t}`);this.innerError=r}};c(kr,"FetchError");var Rr=class extends Error{constructor(t){super(`DUPLICATE_LEAFS${t?` : ${t}`:""}`)}};c(Rr,"DuplicateLeafsError");var Fr=class extends Error{constructor(t){super(`Auction already started with existing bid${t?`, id: ${t}`:""}`)}};c(Fr,"AuctionAlreadyStartedError");var sa=class extends Error{constructor(t){super(`FUNCTION DEPRECATED. ${t?`Use ${t} instead`:""}`)}};c(sa,"FunctionDeprecatedError");var wt=class extends Error{constructor(t,r){super(`Could not find listing.${t?` marketplace address: ${t}`:""}${r?` listing id: ${r}`:""}`)}};c(wt,"ListingNotFoundError");var jt=class extends Error{constructor(t,r,e,a){super(`Incorrect listing type. Are you sure you're using the right method?.${t?` marketplace address: ${t}`:""}${r?` listing id: ${r}`:""}${a?` expected type: ${a}`:""}${e?` actual type: ${e}`:""}`)}};c(jt,"WrongListingTypeError");var ia=class extends Error{constructor(t){super(`Failed to transfer asset, transfer is restricted.${t?` Address : ${t}`:""}`)}};c(ia,"RestrictedTransferError");var ca=class extends Error{constructor(t,r,e="Failed to execute transaction"){super(`${e}, admin role is missing${t?` on address: ${t}`:""}${r?` on contract: ${r}`:""}`)}};c(ca,"AdminRoleMissingError");var Ir=class extends Error{constructor(t,r){super(`Auction has not ended yet${t?`, id: ${t}`:""}${r?`, end time: ${r.toString()}`:""}`)}};c(Ir,"AuctionHasNotEndedError");var ue=class extends Error{constructor(t,r,e,a,n,s,i){let p=`Contract transaction failed

`;p+=`Message: ${t}`,p+=`

| Transaction info |
`,p+=Ar("from",r),p+=Ar("to",e),p+=Ar("data",a),p+=Ar("chain",`${n.name} (${n.chainId})`);try{let d=new URL(s);p+=Ar("RPC",d.hostname)}catch{}p+=`

`,p+="Need help with this error? Join our community: https://discord.gg/thirdweb",p+=`



`,p+="| Raw error |",p+=`

`,p+=i;super(p);this.reason=t,this.from=r,this.to=e,this.data=a,this.chain=n,this.rpcUrl=s}};c(ue,"TransactionError");async function pa(o,t,r,e){let a;if(o.data)a=JSON.stringify(o.data);else if(o instanceof Error)a=o.message;else return o;let n=vr(/.*?"message[^a-zA-Z0-9]*([^"\\]*).*?/,a),s=vr(/.*?"data[^a-zA-Z0-9]*([^"\\]*).*?/,a),i=vr(/.*?"url[^a-zA-Z0-9]*([^"\\]*).*?/,a),p=vr(/.*?"from[^a-zA-Z0-9]*([^"\\]*).*?/,a),d=vr(/.*?"to[^a-zA-Z0-9]*([^"\\]*).*?/,a);return d===""&&(d=e),p===""&&(p=r),new ue(n,p,d,s,t,i,a)}c(pa,"convertToTWError");function Ar(o,t){if(t==="")return t;let r=Array(10-o.length).fill(" ").join("");return`
${o}:${r}${t}`}c(Ar,"withSpaces");function vr(o,t){let r=t.match(o)||[],e="";return(r==null?void 0:r.length)>0&&(e+=r[1]),e}c(vr,"parseMessageParts");var N=class{constructor(t,r){this.contractWrapper=t,this.roles=r}async getAll(){(0,Ht.default)(this.roles.length,"this contract has no support for roles");let t={};for(let r of this.roles)t[r]=await this.get(r);return t}async get(t){(0,Ht.default)(this.roles.includes(t),`this contract does not support the "${t}" role`);let r=D(t),e=(await this.contractWrapper.readContract.getRoleMemberCount(r)).toNumber();return await Promise.all(Array.from(Array(e).keys()).map(a=>this.contractWrapper.readContract.getRoleMember(r,a)))}async setAll(t){let r=Object.keys(t);(0,Ht.default)(r.length,"you must provide at least one role to set"),(0,Ht.default)(r.every(n=>this.roles.includes(n)),"this contract does not support the given role");let e=await this.getAll(),a=[];return r.sort(n=>n==="admin"?1:-1).forEach(async n=>{let s=t[n]||[],i=e[n]||[],p=s.filter(m=>!i.includes(m)),d=i.filter(m=>!s.includes(m));p.length&&p.forEach(m=>{a.push(this.contractWrapper.readContract.interface.encodeFunctionData("grantRole",[D(n),m]))}),d.length&&d.forEach(async m=>{let u=await this.getRevokeRoleFunctionName(m);a.push(this.contractWrapper.readContract.interface.encodeFunctionData(u,[D(n),m]))})}),{receipt:await this.contractWrapper.multiCall(a)}}async verify(t,r){await Promise.all(t.map(async e=>{if(!(await this.get(e)).map(n=>n.toLowerCase()).includes(r.toLowerCase()))throw new xr(r,e)}))}async grant(t,r){return(0,Ht.default)(this.roles.includes(t),`this contract does not support the "${t}" role`),{receipt:await this.contractWrapper.sendTransaction("grantRole",[D(t),r])}}async revoke(t,r){(0,Ht.default)(this.roles.includes(t),`this contract does not support the "${t}" role`);let e=await this.getRevokeRoleFunctionName(r);return{receipt:await this.contractWrapper.sendTransaction(e,[D(t),r])}}async getRevokeRoleFunctionName(t){return(await this.contractWrapper.getSignerAddress()).toLowerCase()===t.toLowerCase()?"renounceRole":"revokeRole"}};c(N,"ContractRoles");var he=require("ethers"),ro=require("ethers/lib/utils"),C=require("zod");var Ft=c(()=>typeof window<"u","isBrowser");globalThis.File||(globalThis.File=require("@web-std/file").File);var da=1e4,Hn=Ft()?[C.z.instanceof(File),C.z.string()]:[C.z.instanceof(Buffer),C.z.string()],It=C.z.union(Hn),eo=C.z.union([C.z.array(C.z.number()),C.z.string()]),T=C.z.union([C.z.string(),C.z.number(),C.z.bigint(),C.z.instanceof(he.BigNumber)]).transform(o=>he.BigNumber.from(o)),pt=T.transform(o=>o.toString()),_t=C.z.number().max(da,"Cannot exeed 100%").min(0,"Cannot be below 0%"),ao=C.z.number().max(100,"Cannot exeed 100%").min(0,"Cannot be below 0%"),zn=C.z.union([C.z.string(),C.z.number(),C.z.boolean(),C.z.null()]),vt=C.z.lazy(()=>C.z.union([zn,C.z.array(vt),C.z.record(vt)])),oo=C.z.record(vt),no=C.z.union([C.z.string().regex(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})$/,"Invalid hex color").transform(o=>o.replace("#","")),C.z.string().length(0)]),dt=C.z.string().refine(o=>(0,ro.isAddress)(o),o=>({message:`${o} is not a valid address`})),B=C.z.union([C.z.string().regex(/^([0-9]+\.?[0-9]*|\.[0-9]+)$/,"Invalid price"),C.z.number().min(0,"Price cannot be negative")]).transform(o=>typeof o=="number"?o.toString():o),so=C.z.date().transform(o=>he.BigNumber.from(Math.floor(o.getTime()/1e3))),fe=so.default(new Date),io=so.default(new Date(Date.now()+1e3*60*60*24*365*10));var Aa=require("@ethersproject/constants"),at=require("zod");var cr=require("zod"),_r=require("ethers");var mo=require("ethers/lib/utils");var h;(function(o){o[o.Mainnet=1]="Mainnet",o[o.Ropsten=3]="Ropsten",o[o.Rinkeby=4]="Rinkeby",o[o.Goerli=5]="Goerli",o[o.Kovan=42]="Kovan",o[o.BSC=56]="BSC",o[o.xDai=100]="xDai",o[o.Polygon=137]="Polygon",o[o.Moonriver=1285]="Moonriver",o[o.Mumbai=80001]="Mumbai",o[o.Harmony=16666e5]="Harmony",o[o.Localhost=1337]="Localhost",o[o.Hardhat=31337]="Hardhat",o[o.Fantom=250]="Fantom",o[o.FantomTestnet=4002]="FantomTestnet",o[o.Avalanche=43114]="Avalanche",o[o.AvalancheFujiTestnet=43113]="AvalancheFujiTestnet"})(h||(h={}));var ma=[h.Mainnet,h.Rinkeby,h.Goerli,h.Polygon,h.Mumbai,h.Fantom,h.FantomTestnet,h.Avalanche,h.AvalancheFujiTestnet];var xt="0xeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",co={[h.Mainnet]:{name:"Ether",symbol:"ETH",decimals:18,wrapped:{address:"0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2",name:"Wrapped Ether",symbol:"WETH"}},[h.Rinkeby]:{name:"Ether",symbol:"ETH",decimals:18,wrapped:{address:"0xc778417E063141139Fce010982780140Aa0cD5Ab",name:"Wrapped Ether",symbol:"WETH"}},[h.Goerli]:{name:"Ether",symbol:"ETH",decimals:18,wrapped:{address:"0x0bb7509324ce409f7bbc4b701f932eaca9736ab7",name:"Wrapped Ether",symbol:"WETH"}},[h.Polygon]:{name:"Matic",symbol:"MATIC",decimals:18,wrapped:{address:"0x0d500B1d8E8eF31E21C99d1Db9A6444d3ADf1270",name:"Wrapped Matic",symbol:"WMATIC"}},[h.Mumbai]:{name:"Matic",symbol:"MATIC",decimals:18,wrapped:{address:"0x9c3C9283D3e44854697Cd22D3Faa240Cfb032889",name:"Wrapped Matic",symbol:"WMATIC"}},[h.Avalanche]:{name:"Avalanche",symbol:"AVAX",decimals:18,wrapped:{address:"0xB31f66AA3C1e785363F0875A1B74E27b85FD66c7",name:"Wrapped AVAX",symbol:"WAVAX"}},[h.AvalancheFujiTestnet]:{name:"Avalanche",symbol:"AVAX",decimals:18,wrapped:{address:"0xd00ae08403B9bbb9124bB305C09058E32C39A48c",name:"Wrapped AVAX",symbol:"WAVAX"}},[h.Fantom]:{name:"Fantom",symbol:"FTM",decimals:18,wrapped:{address:"0x21be370D5312f44cB42ce377BC9b8a0cEF1A4C83",name:"Wrapped Fantom",symbol:"WFTM"}},[h.FantomTestnet]:{name:"Fantom",symbol:"FTM",decimals:18,wrapped:{address:"0xf1277d1Ed8AD466beddF92ef448A132661956621",name:"Wrapped Fantom",symbol:"WFTM"}},[h.Hardhat]:{name:"Ether",symbol:"ETH",decimals:18,wrapped:{address:"0x5FbDB2315678afecb367f032d93F642f64180aa3",name:"Wrapped Ether",symbol:"WETH"}}};function la(o){return co[o]}c(la,"getNativeTokenByChainId");var sr=require("zod");var po=sr.z.object({name:sr.z.string(),symbol:sr.z.string(),decimals:sr.z.number()}),ua=po.extend({value:T,displayValue:sr.z.string()});var M=require("zod"),Ct=M.z.object({merkle:M.z.record(M.z.string()).default({})}),ge=M.z.object({address:M.z.string(),maxClaimable:M.z.number().default(0)}),zt=M.z.union([M.z.array(M.z.string()).transform(o=>o.map(t=>ge.parse({address:t}))),M.z.array(ge)]),ir=M.z.object({merkleRoot:M.z.string(),claims:M.z.array(ge.extend({proof:M.z.array(M.z.string())}))}),Zn=M.z.object({merkleRoot:M.z.string(),snapshotUri:M.z.string(),snapshot:ir});var pr=cr.z.object({startTime:fe,currencyAddress:cr.z.string().default(xt),price:B.default(0),maxQuantity:pt.default(_r.ethers.constants.MaxUint256),quantityLimitPerTransaction:pt.default(_r.ethers.constants.MaxUint256),waitInSeconds:pt.default(0),merkleRootHash:eo.default((0,mo.hexZeroPad)([0],32)),snapshot:cr.z.optional(zt)}),ha=cr.z.array(pr),qn=pr.partial(),ye=pr.extend({availableSupply:cr.z.string().default(""),currencyMetadata:ua.default({value:_r.BigNumber.from("0"),displayValue:"0",symbol:"",decimals:18,name:""}),price:T,maxQuantity:T,quantityLimitPerTransaction:T,waitInSeconds:T,startTime:T.transform(o=>new Date(o.toNumber()*1e3))});var Dt=require("zod");var ht=require("zod");var Ot=require("zod");var lo=vt.or(It),Kn=Ot.z.union([Ot.z.array(Ot.z.object({key:Ot.z.string(),value:lo})).superRefine((o,t)=>{if(!o)return;let r={};o.forEach(({key:e},a)=>{r[e]||(r[e]=0),r[e]++,r[e]>1&&t.addIssue({code:Ot.z.ZodIssueCode.custom,message:`Duplicate key: ${e}`,path:[a,"key"]})})}),Ot.z.record(lo)]).optional(),fa=Ot.z.preprocess(o=>{let t=o;return Array.isArray(t)?t.filter(r=>r.value):t},Kn).transform(o=>Array.isArray(o)?o.reduce((t,r)=>O(S({},t),{[r.key]:r.value}),{}):o),ga=oo.optional();var uo=ht.z.object({name:ht.z.string().nonempty({message:"A name is required."}),description:ht.z.string().optional(),image:It.optional(),external_url:It.optional()}).catchall(ht.z.lazy(()=>vt)),Jn=uo.extend({id:T,uri:ht.z.string(),image:ht.z.string().optional(),external_url:ht.z.string().optional()}),nt=uo.extend({animation_url:It.optional(),background_color:no.optional(),properties:fa}),we=ht.z.union([nt,ht.z.string()]),Ce=Jn.extend({animation_url:ht.z.string().optional(),properties:ga});var Se=require("@ethersproject/constants"),go=require("ethers");var ho=require("uuid"),Or=require("ethers/lib/utils");function fo(o){if(o===void 0){let t=Buffer.alloc(16);return(0,ho.v4)({},t),(0,Or.hexlify)((0,Or.toUtf8Bytes)(t.toString("hex")))}else return(0,Or.hexlify)(o)}c(fo,"resolveOrGenerateId");var ya=Dt.z.object({to:Dt.z.string().default(Se.AddressZero),price:B.default(0),currencyAddress:Dt.z.string().default(xt),mintStartTime:fe,mintEndTime:io,uid:Dt.z.string().optional().transform(o=>fo(o)),primarySaleRecipient:Dt.z.string().default(Se.AddressZero)}),Te=ya.extend({quantity:B}),wa=Te.extend({mintStartTime:T,mintEndTime:T}),Dr=ya.extend({metadata:we,royaltyRecipient:Dt.z.string().default(Se.AddressZero),royaltyBps:_t.default(0)}),We=Dr.extend({uri:Dt.z.string(),royaltyBps:T,mintStartTime:T,mintEndTime:T}),Ca=Dr.extend({tokenId:pt.default(go.ethers.constants.MaxUint256),quantity:pt}),Sa=We.extend({tokenId:T,quantity:T}),Ta=[{name:"to",type:"address"},{name:"primarySaleRecipient",type:"address"},{name:"quantity",type:"uint256"},{name:"price",type:"uint256"},{name:"currency",type:"address"},{name:"validityStartTimestamp",type:"uint128"},{name:"validityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}],Wa=[{name:"to",type:"address"},{name:"royaltyRecipient",type:"address"},{name:"royaltyBps",type:"uint256"},{name:"primarySaleRecipient",type:"address"},{name:"uri",type:"string"},{name:"price",type:"uint256"},{name:"currency",type:"address"},{name:"validityStartTimestamp",type:"uint128"},{name:"validityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}],ba=[{name:"to",type:"address"},{name:"royaltyRecipient",type:"address"},{name:"royaltyBps",type:"uint256"},{name:"primarySaleRecipient",type:"address"},{name:"tokenId",type:"uint256"},{name:"uri",type:"string"},{name:"quantity",type:"uint256"},{name:"pricePerToken",type:"uint256"},{name:"currency",type:"address"},{name:"validityStartTimestamp",type:"uint128"},{name:"validityEndTimestamp",type:"uint128"},{name:"uid",type:"bytes32"}];var v=at.z.object({name:at.z.string(),description:at.z.string().optional(),image:It.optional(),external_link:at.z.string().url().optional()}),k=v.extend({image:at.z.string().optional()}).catchall(at.z.lazy(()=>vt)),x=at.z.object({seller_fee_basis_points:_t.default(0),fee_recipient:dt.default(Aa.AddressZero)}),st=at.z.object({primary_sale_recipient:dt}),P=at.z.object({platform_fee_basis_points:_t.default(0),platform_fee_recipient:dt.default(Aa.AddressZero)}),R=at.z.object({trusted_forwarders:at.z.array(dt).default([])}),L=at.z.object({symbol:at.z.string().optional().default("")});var rt=class{constructor(t,r){this.contractWrapper=t,this.metadata=r}async getDefaultRoyaltyInfo(){let[t,r]=await this.contractWrapper.readContract.getDefaultRoyaltyInfo();return x.parse({fee_recipient:t,seller_fee_basis_points:r})}async getTokenRoyaltyInfo(t){let[r,e]=await this.contractWrapper.readContract.getRoyaltyInfoForToken(t);return x.parse({fee_recipient:r,seller_fee_basis_points:e})}async setDefaultRoyaltyInfo(t){let r=await this.metadata.get(),e=this.metadata.parseInputMetadata(S(S({},r),t)),a=await this.metadata._parseAndUploadMetadata(e),n=[this.contractWrapper.readContract.interface.encodeFunctionData("setDefaultRoyaltyInfo",[e.fee_recipient,e.seller_fee_basis_points]),this.contractWrapper.readContract.interface.encodeFunctionData("setContractURI",[a])];return{receipt:await this.contractWrapper.multiCall(n),data:()=>this.getDefaultRoyaltyInfo()}}async setTokenRoyaltyInfo(t,r){return{receipt:await this.contractWrapper.sendTransaction("setRoyaltyInfoForToken",[t,r.fee_recipient,r.seller_fee_basis_points]),data:()=>this.getDefaultRoyaltyInfo()}}};c(rt,"ContractRoyalty");var it=class{constructor(t){this.contractWrapper=t}async getRecipient(){return await this.contractWrapper.readContract.primarySaleRecipient()}async setRecipient(t){return{receipt:await this.contractWrapper.sendTransaction("setPrimarySaleRecipient",[t])}}};c(it,"ContractPrimarySale");var Fo=require("@thirdweb-dev/contracts"),Lr=require("ethers");var Po=require("@ethersproject/constants");var W=require("ethers");var lr=require("@ethersproject/providers"),St=require("ethers"),yo=require("eventemitter2");var Nr=require("@ethersproject/constants");var dr="0xc82BbE41f2cF04e3a8efA18F7032BDD7f6d98a81",Pt="0x7c487845f98938Bb955B1D5AD069d9a30e4131fd",Et="0x11c34F062Cb10a20B9F463E12Ff9dA62D76FDf65",be={[h.Mainnet]:{biconomyForwarder:"0x84a0856b038eaAd1cC7E297cF34A7e72685A8693",twFactory:Et,twRegistry:Pt},[h.Rinkeby]:{biconomyForwarder:"0xFD4973FeB2031D4409fB57afEE5dF2051b171104",twFactory:Et,twRegistry:Pt},[h.Goerli]:{biconomyForwarder:Nr.AddressZero,twFactory:Et,twRegistry:Pt},[h.Polygon]:{biconomyForwarder:"0x86C80a8aa58e0A4fa09A69624c31Ab2a6CAD56b8",twFactory:Et,twRegistry:Pt},[h.Mumbai]:{biconomyForwarder:"0x9399BB24DBB5C4b782C70c2969F58716Ebbd6a3b",twFactory:Et,twRegistry:Pt},[h.Avalanche]:{biconomyForwarder:"0x64CD353384109423a966dCd3Aa30D884C9b2E057",twFactory:Et,twRegistry:Pt},[h.AvalancheFujiTestnet]:{biconomyForwarder:"0x6271Ca63D30507f2Dcbf99B52787032506D75BBF",twFactory:Et,twRegistry:Pt},[h.Fantom]:{biconomyForwarder:Nr.AddressZero,twFactory:Et,twRegistry:Pt},[h.FantomTestnet]:{biconomyForwarder:Nr.AddressZero,twFactory:Et,twRegistry:Pt}};function mr(o,t){return o===h.Hardhat?t==="twFactory"?process.env.factoryAddress:t==="twRegistry"?process.env.registryAddress:Nr.AddressZero:be[o][t]}c(mr,"getContractAddressByChainId");var Z=require("zod"),mt=Z.z.object({readonlySettings:Z.z.object({rpcUrl:Z.z.string().url(),chainId:Z.z.number().optional()}).optional(),gasSettings:Z.z.object({maxPriceInGwei:Z.z.number().min(1,"gas price cannot be less than 1").default(300),speed:Z.z.enum(["standard","fast","fastest"]).default("fastest")}).default({maxPriceInGwei:300,speed:"fastest"}),gasless:Z.z.union([Z.z.object({openzeppelin:Z.z.object({relayerUrl:Z.z.string().url(),relayerForwarderAddress:Z.z.string().default(dr)})}),Z.z.object({biconomy:Z.z.object({apiId:Z.z.string(),apiKey:Z.z.string(),deadlineSeconds:Z.z.number().min(1,"deadlineSeconds cannot be les than 1").default(3600)})})]).optional()}).default({gasSettings:{maxPriceInGwei:300,speed:"fastest"}});var Nt=class extends yo.EventEmitter2{constructor(t,r){super();let[e,a]=this.getSignerAndProvider(t,r);this.signer=e,this.provider=a;try{this.options=mt.parse(r)}catch(n){console.error("invalid sdk options object passed, falling back to default options",n),this.options=mt.parse({})}}updateSignerOrProvider(t){let[r,e]=this.getSignerAndProvider(t,this.options);this.signer=r,this.provider=e}isReadOnly(){return!St.Signer.isSigner(this.signer)}getSigner(){return this.signer}getProvider(){return this.provider}getSignerOrProvider(){return this.getSigner()||this.getProvider()}getSignerAndProvider(t,r){var n;let e,a;return St.Signer.isSigner(t)&&(e=t,t.provider&&(a=t.provider)),r!=null&&r.readonlySettings&&(a=this.getReadOnlyProvider(r.readonlySettings.rpcUrl,r.readonlySettings.chainId)),a||(lr.Provider.isProvider(t)?a=t:St.Signer.isSigner(t)||(typeof t=="string"?a=this.getReadOnlyProvider(t,(n=r==null?void 0:r.readonlySettings)==null?void 0:n.chainId):a=St.ethers.getDefaultProvider(t))),a||(a=St.ethers.getDefaultProvider(),console.error("No provider found, using default provider on default chain!")),[e,a]}getReadOnlyProvider(t,r){try{let e=t.match(/^(ws|http)s?:/i);if(e)switch(e[1]){case"http":return new lr.JsonRpcBatchProvider(t,r);case"ws":return new lr.WebSocketProvider(t,r);default:return St.ethers.getDefaultProvider(t)}else return St.ethers.getDefaultProvider(t)}catch{return St.ethers.getDefaultProvider(t)}}};c(Nt,"RPCConnectionHandler");var ft;(function(o){o.Transaction="transaction",o.Signature="signature"})(ft||(ft={}));var Zt=tt(require("tiny-invariant"));var Ae=require("ethers"),Co=[{name:"from",type:"address"},{name:"to",type:"address"},{name:"value",type:"uint256"},{name:"gas",type:"uint256"},{name:"nonce",type:"uint256"},{name:"data",type:"bytes"}],So=[{inputs:[{internalType:"address",name:"from",type:"address"},{internalType:"uint256",name:"batchId",type:"uint256"}],name:"getNonce",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"}],ur={},wo={};async function va(o,t,r){let e=r.join("|"),a=wo[e],n=Date.now()-a>=2e3;if(!(e in ur)||n){let i=await o.functions[t](...r);Array.isArray(i)&&i.length>0?ur[e]=Ae.BigNumber.from(i[0]):ur[e]=Ae.BigNumber.from(i),wo[e]=Date.now()}let s=ur[e];return ur[e]=Ae.BigNumber.from(ur[e]).add(1),s}c(va,"getAndIncrementNonce");var xo=require("@thirdweb-dev/contracts");var Tt=require("ethers");var ve=require("ethers");async function Br(o,t,r,e){var i,p;let a=o==null?void 0:o.provider;if(!a)throw new Error("missing provider");let n=ve.ethers.utils._TypedDataEncoder.getPayload(t,r,e),s="";if((i=a==null?void 0:a.provider)!=null&&i.isWalletConnect)s=await a.send("eth_signTypedData",[(await o.getAddress()).toLowerCase(),JSON.stringify(n)]);else try{s=await o._signTypedData(t,r,e)}catch(d){if((p=d==null?void 0:d.message)!=null&&p.includes("Method eth_signTypedData_v4 not supported"))s=await a.send("eth_signTypedData",[(await o.getAddress()).toLowerCase(),JSON.stringify(n)]);else throw d}return{payload:n,signature:ve.ethers.utils.joinSignature(ve.ethers.utils.splitSignature(s))}}c(Br,"signTypedDataInternal");var Qn=[{inputs:[],name:"name",outputs:[{internalType:"string",name:"",type:"string"}],stateMutability:"view",type:"function"}],Yn=[{constant:!0,inputs:[],name:"DOMAIN_SEPARATOR",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],payable:!1,stateMutability:"view",type:"function"},{inputs:[],name:"getDomainSeperator",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"}],Xn=[{inputs:[{internalType:"address",name:"owner",type:"address"}],name:"nonces",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"}],name:"getNonce",outputs:[{internalType:"uint256",name:"nonce",type:"uint256"}],stateMutability:"view",type:"function"}];async function ts(o,t){let r=new Tt.Contract(t,Xn,o);try{return await r.nonces(await o.getAddress())}catch{return await r.getNonce(await o.getAddress())}}c(ts,"getSignerNonce");async function rs(o,t){let r=new Tt.Contract(t,Yn,o);try{return await r.DOMAIN_SEPARATOR()}catch{return await r.getDomainSeperator()}}c(rs,"getDomainSeperator");async function es(o,t){return new Tt.Contract(t,Qn,o).name()}c(es,"getTokenName");async function as(o,t){let r=await rs(o,t.verifyingContract),e={name:t.name,version:t.version,verifyingContract:t.verifyingContract,salt:Tt.ethers.utils.hexZeroPad(Tt.BigNumber.from(t.chainId).toHexString(),32)};return Tt.ethers.utils._TypedDataEncoder.hashDomain(e)===r?e:t}c(as,"getChainDomainSeperator");async function To(o,t,r,e,a,n,s){let i=await as(o,{name:await es(o,t),version:"1",chainId:await o.getChainId(),verifyingContract:t});s=s!=null?s:(await ts(o,t)).toString(),n=n!=null?n:Tt.ethers.constants.MaxUint256;let p={owner:r,spender:e,value:a,nonce:s,deadline:n},d={Permit:[{name:"owner",type:"address"},{name:"spender",type:"address"},{name:"value",type:"uint256"},{name:"nonce",type:"uint256"},{name:"deadline",type:"uint256"}]},{signature:m}=await Br(o,i,d,p);return{message:p,signature:m}}c(To,"signEIP2612Permit");var xe=require("ethers");function os(o){switch(o){case h.Polygon:return"https://gasstation-mainnet.matic.network/v2";case h.Mumbai:return"https://gasstation-mumbai.matic.today/v2"}}c(os,"getGasStationUrl");var ns=xe.ethers.utils.parseUnits("31","gwei"),ss=xe.ethers.utils.parseUnits("1","gwei");function is(o){switch(o){case h.Polygon:return ns;case h.Mumbai:return ss}}c(is,"getDefaultGasFee");async function Wo(o){let t=os(o);try{let e=(await(await fetch(t)).json()).standard.maxPriorityFee;if(e>0){let a=parseFloat(e).toFixed(9);return xe.ethers.utils.parseUnits(a,"gwei")}}catch(r){console.error("failed to fetch gas",r)}return is(o)}c(Wo,"getPolygonGasPriorityFee");var hr=require("ethers");var fr={[h.Polygon]:{vrfCoordinator:"0x3d2341ADb2D31f1c5530cDC622016af293177AE0",linkTokenAddress:"0xb0897686c545045aFc77CF20eC7A532E3120E0F1",keyHash:"0xf86195cf7690c55907b2b611ebb7343a6f649bff128701cc542f0569e2c549da",fees:hr.ethers.utils.parseEther("0.0001")},[h.Mumbai]:{vrfCoordinator:"0x8C7382F9D8f56b33781fE506E897a4F1e2d17255",linkTokenAddress:"0x326C977E6efc84E512bB9C30f76E30c160eD06FB",keyHash:"0x6e75b569a01ef56d18cab6a8e71e6600d6ce853834d4a5748b720d06f878b3a4",fees:hr.ethers.utils.parseEther("0.0001")},[h.Rinkeby]:{vrfCoordinator:"0xb3dCcb4Cf7a26f6cf6B120Cf5A73875B7BBc655B",linkTokenAddress:"0x01be23585060835e02b77ef475b0cc51aa1e0709",keyHash:"0x2ed0feb3e7fd2022120aa84fab1945545a9f2ffc9076fd6156fa96eaff4c1311",fees:hr.ethers.utils.parseEther("0.1")},[h.Mainnet]:{vrfCoordinator:"0xf0d54349aDdcf704F77AE15b96510dEA15cb7952",linkTokenAddress:"0x514910771AF9Ca656af840dff83E8264EcF986CA",keyHash:"0xAA77729D3466CA35AE8D28B3BBAC7CC36A5031EFDC430821C02BC31A238AF445",fees:hr.ethers.utils.parseEther("2")},[h.Hardhat]:{vrfCoordinator:"0x8C7382F9D8f56b33781fE506E897a4F1e2d17255",linkTokenAddress:"0x326C977E6efc84E512bB9C30f76E30c160eD06FB",keyHash:"0x6e75b569a01ef56d18cab6a8e71e6600d6ce853834d4a5748b720d06f878b3a4",fees:hr.ethers.utils.parseEther("0.0001")}};var xa=require("ethers/lib/utils"),Bt=(0,xa.arrayify)("0x80ac58cd"),Mt=(0,xa.arrayify)("0xd9b67a26");var Pa="https://gateway.ipfscdn.io/ipfs/",Ea="https://upload.nftlabs.co",ka="https://api.pinata.cloud/pinning/pinFileToIPFS";var bo=tt(require("merkletreejs"));var Ao=tt(require("keccak256")),Pe=require("ethers");async function Ra(o,t){let r=zt.parse(o),e=r.map(d=>d.address);if(new Set(e).size<e.length)throw new Rr;let n=r.map(d=>vo(d.address,d.maxClaimable)),s=new bo.default(n,Ao.default,{sort:!0}),i=ir.parse({merkleRoot:s.getHexRoot(),claims:r.map((d,m)=>{let u=s.getHexProof(n[m]);return{address:d.address,maxClaimable:d.maxClaimable,proof:u}})}),p=await t.uploadMetadata(i);return{merkleRoot:s.getHexRoot(),snapshotUri:p,snapshot:i}}c(Ra,"createSnapshot");function vo(o,t){return Pe.ethers.utils.solidityKeccak256(["address","uint256"],[o,Pe.BigNumber.from(t)])}c(vo,"hashLeafNode");var w=class extends Nt{customOverrides=()=>({});constructor(t,r,e,a){super(t,a);this.writeContract=new W.Contract(r,e,this.getSignerOrProvider()),this.readContract=this.writeContract.connect(this.getProvider())}updateSignerOrProvider(t){super.updateSignerOrProvider(t),this.writeContract=this.writeContract.connect(this.getSignerOrProvider()),this.readContract=this.writeContract.connect(this.getProvider())}async getChainID(){let t=this.getProvider(),{chainId:r}=await t.getNetwork();return r}async getSignerAddress(){let t=this.getSigner();if(!t)throw new Error("This action requires a connected wallet to sign the transaction. Please pass a valid signer to the SDK.");return await t.getAddress()}callStatic(){return this.writeContract.callStatic}async getCallOverrides(){if(Ft())return{};let t=await this.getProvider().getFeeData();if(t.maxFeePerGas&&t.maxPriorityFeePerGas){let e=await this.getChainID(),a=await this.getProvider().getBlock("latest"),n=a&&a.baseFeePerGas?a.baseFeePerGas:W.ethers.utils.parseUnits("1","gwei"),s;e===h.Mumbai||e===h.Polygon?s=await Wo(e):s=W.BigNumber.from(t.maxPriorityFeePerGas);let i=this.getPreferredPriorityFee(s);return{maxFeePerGas:n.mul(2).add(i),maxPriorityFeePerGas:i}}else return{gasPrice:await this.getPreferredGasPrice()}}getPreferredPriorityFee(t){let r=this.options.gasSettings.speed,e=this.options.gasSettings.maxPriceInGwei,a;switch(r){case"standard":a=W.BigNumber.from(0);break;case"fast":a=t.div(100).mul(5);break;case"fastest":a=t.div(100).mul(10);break}let n=t.add(a),s=W.ethers.utils.parseUnits(e.toString(),"gwei"),i=W.ethers.utils.parseUnits("2.5","gwei");return n.gt(s)&&(n=s),n.lt(i)&&(n=i),n}async getPreferredGasPrice(){let t=await this.getProvider().getGasPrice(),r=this.options.gasSettings.speed,e=this.options.gasSettings.maxPriceInGwei,a=t,n;switch(r){case"standard":n=W.BigNumber.from(1);break;case"fast":n=t.div(100).mul(5);break;case"fastest":n=t.div(100).mul(10);break}a=a.add(n);let s=W.ethers.utils.parseUnits(e.toString(),"gwei");return a.gt(s)&&(a=s),a}emitTransactionEvent(t,r){this.emit(ft.Transaction,{status:t,transactionHash:r})}async multiCall(t){return this.sendTransaction("multicall",[t])}async estimateGas(t,r){return this.writeContract.estimateGas[t](...r)}withTransactionOverride(t){this.customOverrides=t}async sendTransaction(t,r,e){var a;if(e||(e=await this.getCallOverrides()),e=S(S({},e),this.customOverrides()),this.customOverrides=()=>({}),((a=this.options)==null?void 0:a.gasless)&&("openzeppelin"in this.options.gasless||"biconomy"in this.options.gasless)){let n=this.getProvider(),s=await this.sendGaslessTransaction(t,r,e);this.emitTransactionEvent("submitted",s);let i=await n.waitForTransaction(s);return this.emitTransactionEvent("completed",s),i}else{let n=await this.sendTransactionByFunction(t,r,e);this.emitTransactionEvent("submitted",n.hash);let s=n.wait();return this.emitTransactionEvent("completed",n.hash),s}}async sendTransactionByFunction(t,r,e){let a=this.writeContract.functions[t];if(!a)throw new Error("invalid function");try{return await a(...r,e)}catch(n){let s=await this.getProvider().getNetwork(),i=await this.getSignerAddress(),p=await this.readContract.address;throw await pa(n,s,i,p)}}async sendGaslessTransaction(t,r=[],e){let a=this.getSigner();(0,Zt.default)(a,"Cannot execute gasless transaction without valid signer");let n=await this.getChainID(),s=await this.getSignerAddress(),i=this.writeContract.address,p=(e==null?void 0:e.value)||0;if(W.BigNumber.from(p).gt(0))throw new Error("Cannot send native token value with gasless transaction");let d=this.writeContract.interface.encodeFunctionData(t,r),m=await this.writeContract.estimateGas[t](...r),u=m.mul(2);m.lt(25e3)&&(u=W.BigNumber.from(5e5));let g={from:s,to:i,data:d,chainId:n,gasLimit:u,functionName:t.toString(),functionArgs:r,callOverrides:e};return await this.defaultGaslessSendFunction(g)}async signTypedData(t,r,e,a){this.emit(ft.Signature,{status:"submitted",message:a,signature:""});let{signature:n}=await Br(t,r,e,a);return this.emit(ft.Signature,{status:"completed",message:a,signature:n}),n}parseLogs(t,r){if(!r||r.length===0)return[];let e=this.writeContract.interface.getEventTopic(t);return r.filter(n=>n.topics.indexOf(e)>=0).map(n=>this.writeContract.interface.parseLog(n))}async defaultGaslessSendFunction(t){return this.options.gasless&&"biconomy"in this.options.gasless?this.biconomySendFunction(t):this.defenderSendFunction(t)}async biconomySendFunction(t){var u,g;(0,Zt.default)(this.options.gasless&&"biconomy"in this.options.gasless,"calling biconomySendFunction without biconomy");let r=this.getSigner(),e=this.getProvider();(0,Zt.default)(r&&e,"signer and provider must be set");let a=new W.ethers.Contract(mr(t.chainId,"biconomyForwarder"),So,e),n=0,s=await va(a,"getNonce",[t.from,n]),i={from:t.from,to:t.to,token:W.ethers.constants.AddressZero,txGas:t.gasLimit.toNumber(),tokenGasPrice:"0",batchId:n,batchNonce:s.toNumber(),deadline:Math.floor(Date.now()/1e3+(((u=this.options)==null?void 0:u.gasless)&&"biconomy"in this.options.gasless&&((g=this.options.gasless.biconomy)==null?void 0:g.deadlineSeconds)||3600)),data:t.data},p=W.ethers.utils.arrayify(W.ethers.utils.solidityKeccak256(["address","address","address","uint256","uint256","uint256","uint256","uint256","bytes32"],[i.from,i.to,i.token,i.txGas,i.tokenGasPrice,i.batchId,i.batchNonce,i.deadline,W.ethers.utils.keccak256(i.data)]));this.emit(ft.Signature,{status:"submitted",message:p,signature:""});let d=await r.signMessage(p);this.emit(ft.Signature,{status:"completed",message:p,signature:d});let m=await fetch("https://api.biconomy.io/api/v2/meta-tx/native",{method:"POST",body:JSON.stringify({from:t.from,apiId:this.options.gasless.biconomy.apiId,params:[i,d],to:t.to,gasLimit:t.gasLimit.toHexString()}),headers:{"x-api-key":this.options.gasless.biconomy.apiKey,"Content-Type":"application/json;charset=utf-8"}});if(m.ok){let y=await m.json();if(!y.txHash)throw new Error(`relay transaction failed: ${y.log}`);return y.txHash}throw new Error(`relay transaction failed with status: ${m.status} (${m.statusText})`)}async defenderSendFunction(t){(0,Zt.default)(this.options.gasless&&"openzeppelin"in this.options.gasless,"calling biconomySendFunction without biconomy");let r=this.getSigner(),e=this.getProvider();(0,Zt.default)(r,"provider is not set"),(0,Zt.default)(e,"provider is not set");let a=this.options.gasless.openzeppelin.relayerForwarderAddress,n=xo.Forwarder__factory.connect(a,e),s=await va(n,"getNonce",[t.from]),i={name:"GSNv2 Forwarder",version:"0.0.1",chainId:t.chainId,verifyingContract:a},p={ForwardRequest:Co},d={from:t.from,to:t.to,value:W.BigNumber.from(0).toString(),gas:W.BigNumber.from(t.gasLimit).toString(),nonce:W.BigNumber.from(s).toString(),data:t.data},m;if(this.emit(ft.Signature,{status:"submitted",message:d,signature:""}),t.functionName==="approve"&&t.functionArgs.length===2){let z=t.functionArgs[0],yt=t.functionArgs[1],{message:lt,signature:ct}=await To(r,this.writeContract.address,t.from,z,yt),{r:_n,s:On,v:Dn}=W.ethers.utils.splitSignature(ct);d={to:this.readContract.address,owner:lt.owner,spender:lt.spender,value:W.BigNumber.from(lt.value).toString(),nonce:W.BigNumber.from(lt.nonce).toString(),deadline:W.BigNumber.from(lt.deadline).toString(),r:_n,s:On,v:Dn},m=ct}else{let{signature:z}=await Br(r,i,p,d);m=z}let u="forward";d!=null&&d.owner&&(u="permit");let g=JSON.stringify({request:d,signature:m,type:u});this.emit(ft.Signature,{status:"completed",message:d,signature:m});let y=await fetch(this.options.gasless.openzeppelin.relayerUrl,{method:"POST",body:g});if(y.ok){let z=await y.json();return JSON.parse(z.result).txHash}throw new Error(`relay transaction failed with status: ${y.status} (${y.statusText})`)}};c(w,"ContractWrapper");var gr=require("ethers"),Mr=require("@thirdweb-dev/contracts");var Eo=require("ethers/lib/utils");function Wt(o){return o.toLowerCase()===xt||o.toLowerCase()===Po.AddressZero}c(Wt,"isNativeToken");async function et(o,t,r){let e=await Lt(o,r);return gr.ethers.utils.parseUnits(B.parse(t),e.decimals)}c(et,"normalizePriceValue");async function Lt(o,t){if(Wt(t)){let r=await o.getNetwork(),e=la(r.chainId);return{name:e.name,symbol:e.symbol,decimals:e.decimals}}else{let r=Mr.TokenERC20__factory.connect(t,o),[e,a,n]=await Promise.all([r.name(),r.symbol(),r.decimals()]);return{name:e,symbol:a,decimals:n}}}c(Lt,"fetchCurrencyMetadata");async function U(o,t,r){let e=await Lt(o,t);return O(S({},e),{value:gr.BigNumber.from(r),displayValue:(0,Eo.formatUnits)(r,e.decimals)})}c(U,"fetchCurrencyValue");async function gt(o,t,r,e){if(Wt(r))e.value=t;else{let a=o.getSigner(),n=o.getProvider(),s=new w(a||n,r,Mr.IERC20__factory.abi,{}),i=await o.getSignerAddress(),p=o.readContract.address;return(await s.readContract.allowance(i,p)).lt(t)&&await s.sendTransaction("approve",[p,t]),e}}c(gt,"setErc20Allowance");async function ko(o,t,r,e){let a=o.getSigner(),n=o.getProvider(),s=new w(a||n,t,Mr.IERC20__factory.abi,{}),i=await o.getSignerAddress(),p=o.readContract.address,d=await s.readContract.allowance(i,p),m=gr.BigNumber.from(r).mul(gr.BigNumber.from(e));d.lt(m)&&await s.sendTransaction("approve",[p,d.add(m)])}c(ko,"approveErc20Allowance");var Io=tt(require("deep-equal"));var $;(function(o){o[o.Direct=0]="Direct",o[o.Auction=1]="Auction"})($||($={}));var Fa;(function(o){o[o.Pending=0]="Pending",o[o.Active=1]="Active",o[o.Canceled=2]="Canceled",o[o.Defeated=3]="Defeated",o[o.Succeeded=4]="Succeeded",o[o.Queued=5]="Queued",o[o.Expired=6]="Expired",o[o.Executed=7]="Executed"})(Fa||(Fa={}));var qt;(function(o){o[o.Against=0]="Against",o[o.For=1]="For",o[o.Abstain=2]="Abstain"})(qt||(qt={}));var A;(function(o){o.NotEnoughSupply="There is not enough supply to claim.",o.AddressNotAllowed="This address is not on the allowlist.",o.WaitBeforeNextClaimTransaction="Not enough time since last claim transaction. Please wait.",o.AlreadyClaimed="You have already claimed the token.",o.NotEnoughTokens="There are not enough tokens in the wallet to pay for the claim.",o.NoActiveClaimPhase="There is no active claim phase at the moment. Please check back in later.",o.NoClaimConditionSet="There is no claim condition set.",o.Unknown="No claim conditions found."})(A||(A={}));var Kt=require("ethers"),Ro=require("@ethersproject/bytes"),Ia=require("@ethersproject/constants");async function Ee(o,t,r,e,a,n=[(0,Ro.hexZeroPad)([0],32)]){let s=await e.getSignerAddress(),i=0;try{if(!t.merkleRootHash.toString().startsWith(Ia.AddressZero)){let u=await _a(t.merkleRootHash.toString(),r,a),g=u&&u.find(y=>y.address.toLowerCase()===s.toLowerCase());if(g===void 0)throw new Error("No claim found for this address");n=g.proof,i=g.maxClaimable}}catch(u){if((u==null?void 0:u.message)==="No claim found for this address")throw u;console.warn("failed to check claim condition merkle root hash, continuing anyways",u)}let p=await e.getCallOverrides()||{},d=t.price,m=t.currencyAddress;return d.gt(0)&&(Wt(m)?p.value=Kt.BigNumber.from(d).mul(o):await ko(e,m,d,o)),{overrides:p,proofs:n,maxQuantityPerTransaction:Kt.BigNumber.from(i),price:d,currencyAddress:m}}c(Ee,"prepareClaim");async function _a(o,t,r){let e=t[o],a;if(e){let n=await r.get(e),s=ir.parse(n);o===s.merkleRoot&&(a=s.claims)}return a}c(_a,"fetchSnapshot");function ke(o,t,r){if(o>=r.length)throw Error(`Index out of bounds - got index: ${o} with ${r.length} conditions`);let e=pr.parse(S(O(S({},r[o]),{price:r[o].price.toString()}),t)),a=ye.parse(e);return r.map((n,s)=>{let i;return s===o?i=a:i=n,O(S({},i),{price:i.price.toString()})})}c(ke,"updateExsitingClaimConditions");async function Re(o,t,r,e){let a=await _a(t,r,e);if(a===void 0)return{proof:[],maxClaimable:0};let n=a.find(s=>s.address.toLowerCase()===(o==null?void 0:o.toLowerCase()));return n===void 0?{proof:[],maxClaimable:0}:{proof:n.proof,maxClaimable:n.maxClaimable}}c(Re,"getClaimerProofs");async function Fe(o,t,r){let e=[],a=await Promise.all(o.map(async i=>{if(i.snapshot){let p=await Ra(zt.parse(i.snapshot),r);e.push(p),i.merkleRootHash=p.merkleRoot}return i})),n=ha.parse(a),s=(await Promise.all(n.map(i=>cs(i,t)))).sort((i,p)=>{let d=Kt.BigNumber.from(i.startTimestamp),m=Kt.BigNumber.from(p.startTimestamp);return d.eq(m)?0:d.gt(m)?1:-1});return{snapshotInfos:e,sortedConditions:s}}c(Fe,"processClaimConditionInputs");async function cs(o,t){let r=o.currencyAddress===Ia.AddressZero?xt:o.currencyAddress;return{startTimestamp:o.startTime,maxClaimableSupply:o.maxQuantity,supplyClaimed:0,quantityLimitPerTransaction:o.quantityLimitPerTransaction,waitTimeInSecondsBetweenClaims:o.waitInSeconds,pricePerToken:await et(t,o.price,r),currency:r,merkleRoot:o.merkleRootHash}}c(cs,"convertToContractModel");async function yr(o,t,r,e){let a=await U(t,o.currency,o.pricePerToken),n=await _a(o.merkleRoot,r,e);return ye.parse({startTime:o.startTimestamp,maxQuantity:o.maxClaimableSupply.toString(),currentMintSupply:o.supplyClaimed.toString(),availableSupply:Kt.BigNumber.from(o.maxClaimableSupply).sub(o.supplyClaimed).toString(),quantityLimitPerTransaction:o.quantityLimitPerTransaction.toString(),waitInSeconds:o.waitTimeInSecondsBetweenClaims.toString(),price:Kt.BigNumber.from(o.pricePerToken),currency:o.currency,currencyAddress:o.currency,currencyMetadata:a,merkleRootHash:o.merkleRoot,snapshot:n})}c(yr,"transformResultToClaimCondition");var _o=require("@ethersproject/constants");var Ur=class{constructor(t,r,e){this.storage=e,this.contractWrapper=t,this.metadata=r}async getActive(){let t=await this.contractWrapper.readContract.getActiveClaimConditionId(),r=await this.contractWrapper.readContract.getClaimConditionById(t),e=await this.metadata.get();return await yr(r,this.contractWrapper.getProvider(),e.merkle,this.storage)}async getAll(){let t=await this.contractWrapper.readContract.claimCondition(),r=t.currentStartId.toNumber(),e=t.count.toNumber(),a=[];for(let s=r;s<r+e;s++)a.push(await this.contractWrapper.readContract.getClaimConditionById(s));let n=await this.metadata.get();return Promise.all(a.map(s=>yr(s,this.contractWrapper.getProvider(),n.merkle,this.storage)))}async canClaim(t,r){return r===void 0&&(r=await this.contractWrapper.getSignerAddress()),(await this.getClaimIneligibilityReasons(t,r)).length===0}async getClaimIneligibilityReasons(t,r){let e=[],a,n;if(r===void 0)throw new Error("addressToCheck is required");try{[a,n]=await Promise.all([this.contractWrapper.readContract.getActiveClaimConditionId(),this.getActive()])}catch(m){return m.message.includes("no public mint condition.")?(e.push(A.NoClaimConditionSet),e):m.message.includes("no active mint condition.")?(e.push(A.NoActiveClaimPhase),e):(e.push(A.Unknown),e)}if(Lr.BigNumber.from(n.availableSupply).lt(t)&&e.push(A.NotEnoughSupply),Lr.ethers.utils.stripZeros(n.merkleRootHash).length>0){let m=n.merkleRootHash.toString(),u=await this.metadata.get(),g=await Re(r,m,u.merkle,this.storage);try{let[y]=await this.contractWrapper.readContract.verifyClaimMerkleProof(a,r,t,g.proof,g.maxClaimable);if(!y)return e.push(A.AddressNotAllowed),e}catch{return e.push(A.AddressNotAllowed),e}}let[i,p]=await this.contractWrapper.readContract.getClaimTimestamp(a,r),d=Lr.BigNumber.from(Date.now()).div(1e3);if(i.gt(0)&&d.lt(p)&&(p.eq(_o.MaxUint256)?e.push(A.AlreadyClaimed):e.push(A.WaitBeforeNextClaimTransaction)),n.price.gt(0)&&!Ft()){let m=n.price.mul(t),u=this.contractWrapper.getProvider();Wt(n.currencyAddress)?(await u.getBalance(r)).lt(m)&&e.push(A.NotEnoughTokens):(await new w(u,n.currencyAddress,Fo.IERC20__factory.abi,{}).readContract.balanceOf(r)).lt(m)&&e.push(A.NotEnoughTokens)}return e}async set(t,r=!1){let{snapshotInfos:e,sortedConditions:a}=await Fe(t,this.contractWrapper.getProvider(),this.storage),n={};e.forEach(p=>{n[p.merkleRoot]=p.snapshotUri});let s=await this.metadata.get(),i=[];if(!(0,Io.default)(s.merkle,n)){let p=this.metadata.parseInputMetadata(O(S({},s),{merkle:n})),d=await this.metadata._parseAndUploadMetadata(p);i.push(this.contractWrapper.readContract.interface.encodeFunctionData("setContractURI",[d]))}return i.push(this.contractWrapper.readContract.interface.encodeFunctionData("setClaimConditions",[a,r])),{receipt:await this.contractWrapper.multiCall(i)}}async update(t,r){let e=await this.getAll(),a=ke(t,r,e);return await this.set(a)}};c(Ur,"DropErc721ClaimConditions");var Oo=require("@thirdweb-dev/contracts"),$r=require("ethers");var Do=tt(require("deep-equal"));var No=require("@ethersproject/constants");var Vr=class{constructor(t,r,e){this.storage=e,this.contractWrapper=t,this.metadata=r}async getActive(t){let r=await this.contractWrapper.readContract.getActiveClaimConditionId(t),e=await this.contractWrapper.readContract.getClaimConditionById(t,r),a=await this.metadata.get();return await yr(e,this.contractWrapper.getProvider(),a.merkle,this.storage)}async getAll(t){let r=await this.contractWrapper.readContract.claimCondition(t),e=r.currentStartId.toNumber(),a=r.count.toNumber(),n=[];for(let i=e;i<e+a;i++)n.push(await this.contractWrapper.readContract.getClaimConditionById(t,i));let s=await this.metadata.get();return Promise.all(n.map(i=>yr(i,this.contractWrapper.getProvider(),s.merkle,this.storage)))}async canClaim(t,r,e){return e===void 0&&(e=await this.contractWrapper.getSignerAddress()),(await this.getClaimIneligibilityReasons(t,r,e)).length===0}async getClaimIneligibilityReasons(t,r,e){let a=[],n,s;if(e===void 0)throw new Error("addressToCheck is required");try{[n,s]=await Promise.all([this.contractWrapper.readContract.getActiveClaimConditionId(t),this.getActive(t)])}catch(u){return u.message.includes("no active mint condition.")?(a.push(A.NoActiveClaimPhase),a):(a.push(A.Unknown),a)}if($r.BigNumber.from(s.availableSupply).lt(r)&&a.push(A.NotEnoughSupply),$r.ethers.utils.stripZeros(s.merkleRootHash).length>0){let u=s.merkleRootHash.toString(),g=await this.metadata.get(),y=await Re(e,u,g.merkle,this.storage);try{let[z]=await this.contractWrapper.readContract.verifyClaimMerkleProof(n,e,t,r,y.proof,y.maxClaimable);if(!z)return a.push(A.AddressNotAllowed),a}catch{return a.push(A.AddressNotAllowed),a}}let[p,d]=await this.contractWrapper.readContract.getClaimTimestamp(t,n,e),m=$r.BigNumber.from(Date.now()).div(1e3);if(p.gt(0)&&m.lt(d)&&(d.eq(No.MaxUint256)?a.push(A.AlreadyClaimed):a.push(A.WaitBeforeNextClaimTransaction)),s.price.gt(0)&&!Ft()){let u=s.price.mul(r),g=this.contractWrapper.getProvider();Wt(s.currencyAddress)?(await g.getBalance(e)).lt(u)&&a.push(A.NotEnoughTokens):(await new w(g,s.currencyAddress,Oo.IERC20__factory.abi,{}).readContract.balanceOf(e)).lt(u)&&a.push(A.NotEnoughTokens)}return a}async set(t,r,e=!1){let{snapshotInfos:a,sortedConditions:n}=await Fe(r,this.contractWrapper.getProvider(),this.storage),s={};a.forEach(d=>{s[d.merkleRoot]=d.snapshotUri});let i=await this.metadata.get(),p=[];for(let d of Object.keys(i.merkle))s[d]=i.merkle[d];if(!(0,Do.default)(i.merkle,s)){let d=this.metadata.parseInputMetadata(O(S({},i),{merkle:s})),m=await this.metadata._parseAndUploadMetadata(d);p.push(this.contractWrapper.readContract.interface.encodeFunctionData("setContractURI",[m]))}return p.push(this.contractWrapper.readContract.interface.encodeFunctionData("setClaimConditions",[t,n,e])),{receipt:await this.contractWrapper.multiCall(p)}}async update(t,r,e){let a=await this.getAll(t),n=ke(r,e,a);return await this.set(t,n)}};c(Vr,"DropErc1155ClaimConditions");var Bo=require("ethers"),Gr=class{constructor(t){this.contractWrapper=t}async getAllClaimerAddresses(t){let r=await this.contractWrapper.readContract.queryFilter(this.contractWrapper.readContract.filters.TokensClaimed(null,Bo.BigNumber.from(t)));return Array.from(new Set(r.map(e=>e.args.claimer)))}};c(Gr,"DropErc1155History");var kt=require("ethers");var on=require("@ethersproject/constants");var Mo=v.merge(x).merge(Ct).merge(L),ps=k.merge(x).merge(Ct).merge(L),ds=Mo.merge(P).merge(st).merge(R),Lo={deploy:ds,output:ps,input:Mo};var Uo=v.merge(x).merge(Ct).merge(L),ms=k.merge(x).merge(Ct).merge(L),ls=Uo.merge(P).merge(st).merge(R),$o={deploy:ls,output:ms,input:Uo};var Vo=v,us=k,hs=Vo.merge(P).merge(R),Go={deploy:hs,output:us,input:Vo};var jo=v.merge(x).merge(L),fs=k.merge(x).merge(L),gs=jo.merge(P).merge(R),Ho={deploy:gs,output:fs,input:jo};var Jt=require("zod");var zo=Jt.z.object({address:dt,sharesBps:_t.gt(0,"Shares must be greater than 0")}),ys=zo.extend({address:dt,sharesBps:_t}),Oa=v.extend({recipients:Jt.z.array(zo).default([]).superRefine((o,t)=>{let r={},e=0;for(let a=0;a<o.length;a++){let n=o[a];r[n.address]&&t.addIssue({code:Jt.z.ZodIssueCode.custom,message:"Duplicate address.",path:[a,"address"]}),r[n.address]=!0,e+=n.sharesBps,e>1e4&&t.addIssue({code:Jt.z.ZodIssueCode.custom,message:"Total shares cannot go over 100%.",path:[a,"sharesBps"]})}e!==1e4&&t.addIssue({code:Jt.z.ZodIssueCode.custom,message:`Total shares need to add up to 100%. Total shares are currently ${e/100}%`,path:[]})})}),ws=k.extend({recipients:Jt.z.array(ys)}),Cs=Oa.merge(P).merge(Oa).merge(R),Zo={deploy:Cs,output:ws,input:Oa};var qo=v.merge(L),Ss=k.merge(L),Ts=qo.merge(P).merge(st).merge(R),Ko={deploy:Ts,output:Ss,input:qo};var Jo=v.merge(x).merge(L),Ws=k.merge(x).merge(L),bs=Jo.merge(P).merge(st).merge(R),Qo={deploy:bs,output:Ws,input:Jo};var Yo=v.merge(x),As=k.merge(x),vs=Yo.merge(P).merge(st).merge(R),Xo={deploy:vs,output:As,input:Yo};var ot=require("zod"),tn=ot.z.object({voting_delay_in_blocks:ot.z.number().min(0).default(0),voting_period_in_blocks:ot.z.number().min(1).default(1),voting_token_address:dt,voting_quorum_fraction:ao.default(0),proposal_token_threshold:pt.default(1)}),xs=tn.extend({proposal_token_threshold:T}),rn=v.merge(tn),Ps=k.merge(xs),Es=rn.merge(R),en={deploy:Es,output:Ps,input:rn},Yc=ot.z.object({proposalId:T,proposer:ot.z.string(),targets:ot.z.array(ot.z.string()),values:ot.z.array(T),signatures:ot.z.array(ot.z.string()),calldatas:ot.z.array(ot.z.string()),startBlock:T,endBlock:T,description:ot.z.string()});var jr=require("zod");var Ie=jr.z.object({supply:T,metadata:Ce}),ks=Ie.extend({owner:jr.z.string(),quantityOwned:T}),Rs=jr.z.object({supply:pt,metadata:nt}),Fs=jr.z.object({supply:pt,metadata:we});var an=require("zod");var Is=an.z.object({toAddress:dt,amount:B});var Hr=class{constructor(t,r,e={}){this.contractWrapper=t,this.storage=r;try{this.options=mt.parse(e)}catch(a){console.error("invalid contract options object passed, falling back to default options",a),this.options=mt.parse({})}}onNetworkUpdated(t){this.contractWrapper.updateSignerOrProvider(t)}getAddress(){return this.contractWrapper.readContract.address}async get(){return await Lt(this.contractWrapper.getProvider(),this.getAddress())}async balance(){return await this.balanceOf(await this.contractWrapper.getSignerAddress())}async balanceOf(t){return this.getValue(await this.contractWrapper.readContract.balanceOf(t))}async totalSupply(){return await this.getValue(await this.contractWrapper.readContract.totalSupply())}async allowance(t){return await this.allowanceOf(await this.contractWrapper.getSignerAddress(),t)}async allowanceOf(t,r){return await this.getValue(await this.contractWrapper.readContract.allowance(t,r))}async isTransferRestricted(){return!await this.contractWrapper.readContract.hasRole(D("transfer"),on.AddressZero)}async transfer(t,r){let e=kt.ethers.utils.parseUnits(B.parse(r),await this.contractWrapper.readContract.decimals());return{receipt:await this.contractWrapper.sendTransaction("transfer",[t,e])}}async transferFrom(t,r,e){let a=kt.ethers.utils.parseUnits(B.parse(e),await this.contractWrapper.readContract.decimals());return{receipt:await this.contractWrapper.sendTransaction("transferFrom",[t,r,a])}}async setAllowance(t,r){let e=kt.ethers.utils.parseUnits(B.parse(r),await this.contractWrapper.readContract.decimals());return{receipt:await this.contractWrapper.sendTransaction("approve",[t,e])}}async transferBatch(t){let r=await this.contractWrapper.readContract.decimals(),e=t.map(a=>{let n=kt.ethers.utils.parseUnits(B.parse(a.amount),r);return this.contractWrapper.readContract.interface.encodeFunctionData("transfer",[a.toAddress,n])});await this.contractWrapper.multiCall(e)}async burn(t){let r=kt.ethers.utils.parseUnits(B.parse(t),await this.contractWrapper.readContract.decimals());return{receipt:await this.contractWrapper.sendTransaction("burn",[r])}}async burnFrom(t,r){let e=kt.ethers.utils.parseUnits(B.parse(r),await this.contractWrapper.readContract.decimals());return{receipt:await this.contractWrapper.sendTransaction("burnFrom",[t,e])}}async getValue(t){return await U(this.contractWrapper.getProvider(),this.getAddress(),kt.BigNumber.from(t))}};c(Hr,"Erc20");var Da=require("ethers"),Na=require("@ethersproject/constants");var zr=class{constructor(t){this.contractWrapper=t}async getAllHolderBalances(){let r=(await this.contractWrapper.readContract.queryFilter(this.contractWrapper.readContract.filters.Transfer())).map(a=>a.args),e={};return r.forEach(a=>{let n=a.from,s=a.to,i=a.value;n!==Na.AddressZero&&(n in e||(e[n]=Da.BigNumber.from(0)),e[n]=e[n].sub(i)),s!==Na.AddressZero&&(s in e||(e[s]=Da.BigNumber.from(0)),e[s]=e[s].add(i))}),Promise.all(Object.keys(e).map(async a=>({holder:a,balance:await U(this.contractWrapper.getProvider(),this.contractWrapper.readContract.address,e[a])})))}};c(zr,"TokenERC20History");var Ba=require("ethers"),Ma=require("@ethersproject/constants");var wr=100;var nn=require("ethers");var Cr=require("@thirdweb-dev/contracts");async function Qt(o,t,r){let e=await r.get(t);return Ce.parse(S({id:nn.BigNumber.from(o),uri:t},e))}c(Qt,"fetchTokenMetadata");async function Ut(o,t,r,e){let a,n=Cr.ERC165__factory.connect(o,t),s=await n.supportsInterface(Bt),i=await n.supportsInterface(Mt);if(s)a=await Cr.TokenERC721__factory.connect(o,t).tokenURI(r);else if(i)a=await Cr.TokenERC1155__factory.connect(o,t).uri(r);else throw Error("Contract must implement ERC 1155 or ERC 721.");if(!a)throw new ut;return Qt(r,a,e)}c(Ut,"fetchTokenMetadataForContract");async function _e(o,t){return typeof o=="string"?o:await t.uploadMetadata(nt.parse(o))}c(_e,"uploadOrExtractURI");async function $t(o,t){if(_s(o))return o;if(Os(o)){let{metadataUris:r}=await t.uploadMetadataBatch(o.map(e=>nt.parse(e)));return r}else throw new Error("NFT metadatas must all be of the same type (all URI or all NFTMetadataInput)")}c($t,"uploadOrExtractURIs");function _s(o){return o.find(t=>typeof t!="string")===void 0}c(_s,"isUriList");function Os(o){return o.find(t=>typeof t!="object")===void 0}c(Os,"isMetadataList");var Yt=class{constructor(t,r,e={}){this.contractWrapper=t,this.storage=r;try{this.options=mt.parse(e)}catch(a){console.error("invalid contract options object passed, falling back to default options",a),this.options=mt.parse({})}}onNetworkUpdated(t){this.contractWrapper.updateSignerOrProvider(t)}getAddress(){return this.contractWrapper.readContract.address}async get(t){let[r,e]=await Promise.all([this.ownerOf(t).catch(()=>Ma.AddressZero),this.getTokenMetadata(t)]);return{owner:r,metadata:e}}async getAll(t){let r=Ba.BigNumber.from((t==null?void 0:t.start)||0).toNumber(),e=Ba.BigNumber.from((t==null?void 0:t.count)||100).toNumber(),a=Math.min((await this.getTotalCount()).toNumber(),r+e);return await Promise.all([...Array(a-r).keys()].map(n=>this.get((r+n).toString())))}async getTotalCount(){return await this.contractWrapper.readContract.nextTokenIdToMint()}async getOwned(t){let r=t||await this.contractWrapper.getSignerAddress(),e=await this.contractWrapper.readContract.balanceOf(r),a=Array.from(Array(e.toNumber()).keys()),n=await Promise.all(a.map(s=>this.contractWrapper.readContract.tokenOfOwnerByIndex(r,s)));return await Promise.all(n.map(s=>this.get(s.toString())))}async ownerOf(t){return await this.contractWrapper.readContract.ownerOf(t)}async totalSupply(){return await this.contractWrapper.readContract.nextTokenIdToMint()}async balanceOf(t){return await this.contractWrapper.readContract.balanceOf(t)}async balance(){return await this.balanceOf(await this.contractWrapper.getSignerAddress())}async isTransferRestricted(){return!await this.contractWrapper.readContract.hasRole(D("transfer"),Ma.AddressZero)}async isApproved(t,r){return await this.contractWrapper.readContract.isApprovedForAll(t,r)}async transfer(t,r){let e=await this.contractWrapper.getSignerAddress();return{receipt:await this.contractWrapper.sendTransaction("safeTransferFrom(address,address,uint256)",[e,t,r])}}async burn(t){return{receipt:await this.contractWrapper.sendTransaction("burn",[t])}}async setApprovalForAll(t,r){return{receipt:await this.contractWrapper.sendTransaction("setApprovalForAll",[t,r])}}async getTokenMetadata(t){let r=await this.contractWrapper.readContract.tokenURI(t);if(!r)throw new ut;return Qt(t,r,this.storage)}};c(Yt,"Erc721");var Oe=require("ethers");var sn=require("@ethersproject/constants");var La;(function(o){o[o.None=0]="None",o[o.ERC20=1]="ERC20",o[o.ERC721=2]="ERC721"})(La||(La={}));var Xt=class{constructor(t,r,e={}){this.contractWrapper=t,this.storage=r;try{this.options=mt.parse(e)}catch(a){console.error("invalid contract options object passed, falling back to default options",a),this.options=mt.parse({})}}onNetworkUpdated(t){this.contractWrapper.updateSignerOrProvider(t)}getAddress(){return this.contractWrapper.readContract.address}async get(t){let[r,e]=await Promise.all([this.contractWrapper.readContract.totalSupply(t).catch(()=>Oe.BigNumber.from(0)),this.getTokenMetadata(t)]);return Ie.parse({supply:r,metadata:e})}async getAll(t){let r=Oe.BigNumber.from((t==null?void 0:t.start)||0).toNumber(),e=Oe.BigNumber.from((t==null?void 0:t.count)||100).toNumber(),a=Math.min((await this.getTotalCount()).toNumber(),r+e);return await Promise.all([...Array(a-r).keys()].map(n=>this.get((r+n).toString())))}async getTotalCount(){return await this.contractWrapper.readContract.nextTokenIdToMint()}async getOwned(t){let r=t||await this.contractWrapper.getSignerAddress(),e=await this.contractWrapper.readContract.nextTokenIdToMint(),n=(await this.contractWrapper.readContract.balanceOfBatch(Array(e.toNumber()).fill(r),Array.from(Array(e.toNumber()).keys()))).map((s,i)=>({tokenId:i,balance:s})).filter(s=>s.balance.gt(0));return await Promise.all(n.map(async s=>{let i=await this.get(s.tokenId.toString());return O(S({},i),{owner:r,quantityOwned:s.balance})}))}async totalSupply(t){return await this.contractWrapper.readContract.totalSupply(t)}async balanceOf(t,r){return await this.contractWrapper.readContract.balanceOf(t,r)}async balance(t){return await this.balanceOf(await this.contractWrapper.getSignerAddress(),t)}async isTransferRestricted(){return!await this.contractWrapper.readContract.hasRole(D("transfer"),sn.AddressZero)}async isApproved(t,r){return await this.contractWrapper.readContract.isApprovedForAll(t,r)}async transfer(t,r,e,a=[0]){let n=await this.contractWrapper.getSignerAddress();return{receipt:await this.contractWrapper.sendTransaction("safeTransferFrom",[n,t,r,e,a])}}async burn(t,r){let e=await this.contractWrapper.getSignerAddress();return{receipt:await this.contractWrapper.sendTransaction("burn",[e,t,r])}}async setApprovalForAll(t,r){return{receipt:await this.contractWrapper.sendTransaction("setApprovalForAll",[t,r])}}async getTokenMetadata(t){let r=await this.contractWrapper.readContract.uri(t);if(!r)throw new ut;return Qt(t,r,this.storage)}};c(Xt,"Erc1155");var Zr=require("ethers"),cn=tt(require("tiny-invariant")),qr=class{constructor(t,r){this.contractWrapper=t,this.roles=r}async mint(t){let r=t.payload,e=t.signature,a=await this.mapPayloadToContractStruct(r),n=await this.contractWrapper.getCallOverrides();return await gt(this.contractWrapper,Zr.BigNumber.from(a.price),r.currencyAddress,n),{receipt:await this.contractWrapper.sendTransaction("mintWithSignature",[a,e],n)}}async mintBatch(t){let e=(await Promise.all(t.map(async a=>{let n=await this.mapPayloadToContractStruct(a.payload),s=a.signature,i=a.payload.price;if(Zr.BigNumber.from(i).gt(0))throw new Error("Can only batch free mints. For mints with a price, use regular mint()");return{message:n,signature:s}}))).map(a=>this.contractWrapper.readContract.interface.encodeFunctionData("mintWithSignature",[a.message,a.signature]));return{receipt:await this.contractWrapper.multiCall(e)}}async verify(t){let r=t.payload,e=t.signature,a=await this.mapPayloadToContractStruct(r);return(await this.contractWrapper.readContract.verify(a,e))[0]}async generate(t){return(await this.generateBatch([t]))[0]}async generateBatch(t){await this.roles.verify(["minter"],await this.contractWrapper.getSignerAddress());let r=t.map(s=>Te.parse(s)),e=await this.contractWrapper.getChainID(),a=this.contractWrapper.getSigner();(0,cn.default)(a,"No signer available");let n=await this.contractWrapper.readContract.name();return await Promise.all(r.map(async s=>{let i=wa.parse(s),p=await this.contractWrapper.signTypedData(a,{name:n,version:"1",chainId:e,verifyingContract:this.contractWrapper.readContract.address},{MintRequest:Ta},await this.mapPayloadToContractStruct(i));return{payload:i,signature:p.toString()}}))}async mapPayloadToContractStruct(t){let r=await et(this.contractWrapper.getProvider(),t.price,t.currencyAddress),e=Zr.ethers.utils.parseUnits(t.quantity,await this.contractWrapper.readContract.decimals());return{to:t.to,primarySaleRecipient:t.primarySaleRecipient,quantity:e,price:r,currency:t.currencyAddress,validityStartTimestamp:t.mintStartTime,validityEndTimestamp:t.mintEndTime,uid:t.uid}}};c(qr,"Erc20SignatureMinting");var Ua=require("ethers"),pn=tt(require("tiny-invariant"));var Kr=class{constructor(t,r,e){this.contractWrapper=t,this.storage=e,this.roles=r}async mint(t){let r=t.payload,e=t.signature,a=await this.mapPayloadToContractStruct(r),n=await this.contractWrapper.getCallOverrides();await gt(this.contractWrapper,Ua.BigNumber.from(a.price),r.currencyAddress,n);let s=await this.contractWrapper.sendTransaction("mintWithSignature",[a,e],n),i=this.contractWrapper.parseLogs("TokensMintedWithSignature",s.logs);if(i.length===0)throw new Error("No MintWithSignature event found");return{id:i[0].args.tokenIdMinted,receipt:s}}async mintBatch(t){let e=(await Promise.all(t.map(async s=>{let i=await this.mapPayloadToContractStruct(s.payload),p=s.signature,d=s.payload.price;if(Ua.BigNumber.from(d).gt(0))throw new Error("Can only batch free mints. For mints with a price, use regular mint()");return{message:i,signature:p}}))).map(s=>this.contractWrapper.readContract.interface.encodeFunctionData("mintWithSignature",[s.message,s.signature])),a=await this.contractWrapper.multiCall(e),n=this.contractWrapper.parseLogs("TokensMintedWithSignature",a.logs);if(n.length===0)throw new Error("No MintWithSignature event found");return n.map(s=>({id:s.args.tokenIdMinted,receipt:a}))}async verify(t){let r=t.payload,e=t.signature,a=await this.mapPayloadToContractStruct(r);return(await this.contractWrapper.readContract.verify(a,e))[0]}async generate(t){return(await this.generateBatch([t]))[0]}async generateBatch(t){await this.roles.verify(["minter"],await this.contractWrapper.getSignerAddress());let r=t.map(i=>Dr.parse(i)),e=r.map(i=>i.metadata),a=await $t(e,this.storage),n=await this.contractWrapper.getChainID(),s=this.contractWrapper.getSigner();return(0,pn.default)(s,"No signer available"),await Promise.all(r.map(async(i,p)=>{let d=a[p],m=We.parse(O(S({},i),{uri:d})),u=await this.contractWrapper.signTypedData(s,{name:"TokenERC721",version:"1",chainId:n,verifyingContract:this.contractWrapper.readContract.address},{MintRequest:Wa},await this.mapPayloadToContractStruct(m));return{payload:m,signature:u.toString()}}))}async mapPayloadToContractStruct(t){let r=await et(this.contractWrapper.getProvider(),t.price,t.currencyAddress);return{to:t.to,price:r,uri:t.uri,currency:t.currencyAddress,validityEndTimestamp:t.mintEndTime,validityStartTimestamp:t.mintStartTime,uid:t.uid,royaltyRecipient:t.royaltyRecipient,royaltyBps:t.royaltyBps,primarySaleRecipient:t.primarySaleRecipient}}};c(Kr,"Erc721SignatureMinting");var dn=tt(require("tiny-invariant")),mn=require("ethers");var Jr=class{constructor(t,r,e){this.contractWrapper=t,this.storage=e,this.roles=r}async mint(t){let r=t.payload,e=t.signature,a=await this.mapPayloadToContractStruct(r),n=await this.contractWrapper.getCallOverrides();await gt(this.contractWrapper,a.pricePerToken.mul(a.quantity),r.currencyAddress,n);let s=await this.contractWrapper.sendTransaction("mintWithSignature",[a,e],n),i=this.contractWrapper.parseLogs("TokensMintedWithSignature",s.logs);if(i.length===0)throw new Error("No MintWithSignature event found");return{id:i[0].args.tokenIdMinted,receipt:s}}async mintBatch(t){let e=(await Promise.all(t.map(async s=>{let i=await this.mapPayloadToContractStruct(s.payload),p=s.signature,d=s.payload.price;if(mn.BigNumber.from(d).gt(0))throw new Error("Can only batch free mints. For mints with a price, use regular mint()");return{message:i,signature:p}}))).map(s=>this.contractWrapper.readContract.interface.encodeFunctionData("mintWithSignature",[s.message,s.signature])),a=await this.contractWrapper.multiCall(e),n=this.contractWrapper.parseLogs("TokensMintedWithSignature",a.logs);if(n.length===0)throw new Error("No MintWithSignature event found");return n.map(s=>({id:s.args.tokenIdMinted,receipt:a}))}async verify(t){let r=t.payload,e=t.signature,a=await this.mapPayloadToContractStruct(r);return(await this.contractWrapper.readContract.verify(a,e))[0]}async generate(t){return(await this.generateBatch([t]))[0]}async generateBatch(t){await this.roles.verify(["minter"],await this.contractWrapper.getSignerAddress());let r=t.map(i=>Ca.parse(i)),e=r.map(i=>i.metadata),a=await $t(e,this.storage),n=await this.contractWrapper.getChainID(),s=this.contractWrapper.getSigner();return(0,dn.default)(s,"No signer available"),await Promise.all(r.map(async(i,p)=>{let d=a[p],m=Sa.parse(O(S({},i),{uri:d})),u=await this.contractWrapper.signTypedData(s,{name:"TokenERC1155",version:"1",chainId:n,verifyingContract:this.contractWrapper.readContract.address},{MintRequest:ba},await this.mapPayloadToContractStruct(m));return{payload:m,signature:u.toString()}}))}async mapPayloadToContractStruct(t){let r=await et(this.contractWrapper.getProvider(),t.price,t.currencyAddress);return{to:t.to,tokenId:t.tokenId,uri:t.uri,quantity:t.quantity,pricePerToken:r,currency:t.currencyAddress,validityStartTimestamp:t.mintStartTime,validityEndTimestamp:t.mintEndTime,uid:t.uid,royaltyRecipient:t.royaltyRecipient,royaltyBps:t.royaltyBps,primarySaleRecipient:t.primarySaleRecipient}}};c(Jr,"Erc1155SignatureMinting");var Sr=require("@thirdweb-dev/contracts"),bt=require("ethers"),$a=require("@ethersproject/constants");var De=require("ethers"),Rt=require("@thirdweb-dev/contracts");var Vt=tt(require("tiny-invariant"));async function ln(o,t,r,e,a){try{let n=Rt.ERC165__factory.connect(r,o),s=await n.supportsInterface(Bt),i=await n.supportsInterface(Mt);if(s){let p=Rt.IERC721__factory.connect(r,o);return await p.isApprovedForAll(a,t)?!0:(await p.getApproved(e)).toLowerCase()===t.toLowerCase()}else return i?await Rt.IERC1155__factory.connect(r,o).isApprovedForAll(a,t):(console.error("Contract does not implement ERC 1155 or ERC 721."),!1)}catch(n){return console.error("Failed to check if token is approved",n),!1}}c(ln,"isTokenApprovedForMarketplace");async function Ne(o,t,r,e,a){let n=Rt.ERC165__factory.connect(r,o),s=await n.supportsInterface(Bt),i=await n.supportsInterface(Mt);if(s){let p=new w(o,r,Rt.IERC721__factory.abi,{});await p.readContract.isApprovedForAll(a,t)||(await p.readContract.getApproved(e)).toLowerCase()===t.toLowerCase()||await p.sendTransaction("setApprovalForAll",[t,!0])}else if(i){let p=new w(o,r,Rt.IERC1155__factory.abi,{});await p.readContract.isApprovedForAll(a,t)||await p.sendTransaction("setApprovalForAll",[t,!0])}else throw Error("Contract must implement ERC 1155 or ERC 721.")}c(Ne,"handleTokenApproval");function Be(o){switch((0,Vt.default)(o.assetContractAddress!==void 0&&o.assetContractAddress!==null,"Asset contract address is required"),(0,Vt.default)(o.buyoutPricePerToken!==void 0&&o.buyoutPricePerToken!==null,"Buyout price is required"),(0,Vt.default)(o.listingDurationInSeconds!==void 0&&o.listingDurationInSeconds!==null,"Listing duration is required"),(0,Vt.default)(o.startTimeInSeconds!==void 0&&o.startTimeInSeconds!==null,"Start time is required"),(0,Vt.default)(o.tokenId!==void 0&&o.tokenId!==null,"Token ID is required"),(0,Vt.default)(o.quantity!==void 0&&o.quantity!==null,"Quantity is required"),o.type){case"NewAuctionListing":(0,Vt.default)(o.reservePricePerToken!==void 0&&o.reservePricePerToken!==null,"Reserve price is required")}}c(Be,"validateNewListingParam");async function Me(o,t,r){return{quantity:r.quantityDesired,pricePerToken:r.pricePerToken,currencyContractAddress:r.currency,buyerAddress:r.offeror,quantityDesired:r.quantityWanted,currencyValue:await U(o,r.currency,r.quantityWanted.mul(r.pricePerToken)),listingId:t}}c(Me,"mapOffer");function un(o,t,r){return r=De.BigNumber.from(r),o=De.BigNumber.from(o),t=De.BigNumber.from(t),t.sub(o).mul(da).div(o).gte(r)}c(un,"isWinningBid");var hn=tt(require("tiny-invariant")),fn=require("ethers/lib/utils"),Qr=class{constructor(t,r){this.contractWrapper=t,this.storage=r}getAddress(){return this.contractWrapper.readContract.address}async getListing(t){let r=await this.contractWrapper.readContract.listings(t);if(r.assetContract===$a.AddressZero)throw new wt(this.getAddress(),t.toString());if(r.listingType!==$.Direct)throw new jt(this.getAddress(),t.toString(),"Auction","Direct");return await this.mapListing(r)}async getActiveOffer(t,r){await this.validateListing(bt.BigNumber.from(t)),(0,hn.default)((0,fn.isAddress)(r),"Address must be a valid address");let e=await this.contractWrapper.readContract.offers(t,r);if(e.offeror!==$a.AddressZero)return await Me(this.contractWrapper.getProvider(),bt.BigNumber.from(t),e)}async createListing(t){Be(t),await Ne(this.contractWrapper.getSignerOrProvider(),this.getAddress(),t.assetContractAddress,t.tokenId,await this.contractWrapper.getSignerAddress());let r=await et(this.contractWrapper.getProvider(),t.buyoutPricePerToken,t.currencyContractAddress),e=await this.contractWrapper.sendTransaction("createListing",[{assetContract:t.assetContractAddress,tokenId:t.tokenId,buyoutPricePerToken:r,currencyToAccept:t.currencyContractAddress,listingType:$.Direct,quantityToList:t.quantity,reservePricePerToken:r,secondsUntilEndTime:t.listingDurationInSeconds,startTime:t.startTimeInSeconds}]);return{id:this.contractWrapper.parseLogs("ListingAdded",e==null?void 0:e.logs)[0].args.listingId,receipt:e}}async makeOffer(t,r,e,a){if(Wt(e))throw new Error("You must use the wrapped native token address when making an offer with a native token");let n=await et(this.contractWrapper.getProvider(),a,e);try{await this.getListing(t)}catch(d){throw console.error("Failed to get listing, err =",d),new Error(`Error getting the listing with id ${t}`)}let s=bt.BigNumber.from(r),i=bt.BigNumber.from(n).mul(s),p=await this.contractWrapper.getCallOverrides()||{};return await gt(this.contractWrapper,i,e,p),{receipt:await this.contractWrapper.sendTransaction("offer",[t,r,e,n],p)}}async acceptOffer(t,r){await this.validateListing(bt.BigNumber.from(t));let e=await this.contractWrapper.readContract.offers(t,r);return{receipt:await this.contractWrapper.sendTransaction("acceptOffer",[t,r,e.currency,e.pricePerToken])}}async buyoutListing(t,r,e){let a=await this.validateListing(bt.BigNumber.from(t));if(!await this.isStillValidListing(a,r))throw new Error("The asset on this listing has been moved from the lister's wallet, this listing is now invalid");let s=e||await this.contractWrapper.getSignerAddress(),i=bt.BigNumber.from(r),p=bt.BigNumber.from(a.buyoutPrice).mul(i),d=await this.contractWrapper.getCallOverrides()||{};return await gt(this.contractWrapper,p,a.currencyContractAddress,d),{receipt:await this.contractWrapper.sendTransaction("buy",[t,s,i,a.currencyContractAddress,p],d)}}async updateListing(t){return{receipt:await this.contractWrapper.sendTransaction("updateListing",[t.id,t.quantity,t.buyoutPrice,t.buyoutPrice,t.currencyContractAddress,t.startTimeInSeconds,t.secondsUntilEnd])}}async cancelListing(t){return{receipt:await this.contractWrapper.sendTransaction("cancelDirectListing",[t])}}async validateListing(t){try{return await this.getListing(t)}catch(r){throw console.error(`Error getting the listing with id ${t}`),r}}async mapListing(t){return{assetContractAddress:t.assetContract,buyoutPrice:bt.BigNumber.from(t.buyoutPricePerToken),currencyContractAddress:t.currency,buyoutCurrencyValuePerToken:await U(this.contractWrapper.getProvider(),t.currency,t.buyoutPricePerToken),id:t.listingId.toString(),tokenId:t.tokenId,quantity:t.quantity,startTimeInSeconds:t.startTime,asset:await Ut(t.assetContract,this.contractWrapper.getProvider(),t.tokenId,this.storage),secondsUntilEnd:t.endTime,sellerAddress:t.tokenOwner,type:$.Direct}}async isStillValidListing(t,r){if(!await ln(this.contractWrapper.getProvider(),this.getAddress(),t.assetContractAddress,t.tokenId,t.sellerAddress))return!1;let a=this.contractWrapper.getProvider(),n=Sr.ERC165__factory.connect(t.assetContractAddress,a),s=await n.supportsInterface(Bt),i=await n.supportsInterface(Mt);return s?(await Sr.IERC721__factory.connect(t.assetContractAddress,a).ownerOf(t.tokenId)).toLowerCase()===t.sellerAddress.toLowerCase():i?(await Sr.IERC1155__factory.connect(t.assetContractAddress,a).balanceOf(t.sellerAddress,t.tokenId)).gte(r||t.quantity):(console.error("Contract does not implement ERC 1155 or ERC 721."),!1)}};c(Qr,"MarketplaceDirect");var q=require("ethers");var Va=require("@ethersproject/constants");var Ga=tt(require("tiny-invariant")),Yr=class{constructor(t,r){this.contractWrapper=t,this.storage=r}getAddress(){return this.contractWrapper.readContract.address}async getListing(t){let r=await this.contractWrapper.readContract.listings(t);if(r.listingId.toString()!==t.toString())throw new wt(this.getAddress(),t.toString());if(r.listingType!==$.Auction)throw new jt(this.getAddress(),t.toString(),"Direct","Auction");return await this.mapListing(r)}async getWinningBid(t){await this.validateListing(q.BigNumber.from(t));let r=await this.contractWrapper.readContract.winningBid(t);if(r.offeror!==Va.AddressZero)return await Me(this.contractWrapper.getProvider(),q.BigNumber.from(t),r)}async getWinner(t){let e=(await this.contractWrapper.readContract.queryFilter(this.contractWrapper.readContract.filters.AuctionClosed())).find(a=>a.args.listingId.eq(q.BigNumber.from(t)));if(!e)throw new Error(`Could not find auction with listingId ${t} in closed auctions`);return e.args.winningBidder}async createListing(t){Be(t),await Ne(this.contractWrapper.getSignerOrProvider(),this.getAddress(),t.assetContractAddress,t.tokenId,await this.contractWrapper.getSignerAddress());let r=await et(this.contractWrapper.getProvider(),t.buyoutPricePerToken,t.currencyContractAddress),e=await et(this.contractWrapper.getProvider(),t.reservePricePerToken,t.currencyContractAddress),a=await this.contractWrapper.sendTransaction("createListing",[{assetContract:t.assetContractAddress,tokenId:t.tokenId,buyoutPricePerToken:r,currencyToAccept:t.currencyContractAddress,listingType:$.Auction,quantityToList:t.quantity,reservePricePerToken:e,secondsUntilEndTime:t.listingDurationInSeconds,startTime:t.startTimeInSeconds}]);return{id:this.contractWrapper.parseLogs("ListingAdded",a==null?void 0:a.logs)[0].args.listingId,receipt:a}}async buyoutListing(t){let r=await this.validateListing(q.BigNumber.from(t)),e=await Lt(this.contractWrapper.getProvider(),r.currencyContractAddress);return this.makeBid(t,q.ethers.utils.formatUnits(r.buyoutPrice,e.decimals))}async makeBid(t,r){let e=await this.validateListing(q.BigNumber.from(t)),a=await et(this.contractWrapper.getProvider(),r,e.currencyContractAddress),n=await this.contractWrapper.readContract.bidBufferBps(),s=await this.getWinningBid(t);if(s){let m=un(s.pricePerToken,a,n);(0,Ga.default)(m,"Bid price is too low based on the current winning bid and the bid buffer")}else{let m=a,u=q.BigNumber.from(e.reservePrice);(0,Ga.default)(m.gte(u),"Bid price is too low based on reserve price")}let i=q.BigNumber.from(e.quantity),p=a.mul(i),d=await this.contractWrapper.getCallOverrides()||{};return await gt(this.contractWrapper,p,e.currencyContractAddress,d),{receipt:await this.contractWrapper.sendTransaction("offer",[t,e.quantity,e.currencyContractAddress,a],d)}}async cancelListing(t){let r=await this.validateListing(q.BigNumber.from(t)),e=q.BigNumber.from(Math.floor(Date.now()/1e3)),a=q.BigNumber.from(r.startTimeInEpochSeconds),n=await this.contractWrapper.readContract.winningBid(t);if(e.gt(a)&&n.offeror!==Va.AddressZero)throw new Fr(t.toString());return{receipt:await this.contractWrapper.sendTransaction("closeAuction",[q.BigNumber.from(t),await this.contractWrapper.getSignerAddress()])}}async closeListing(t,r){r||(r=await this.contractWrapper.getSignerAddress());let e=await this.validateListing(q.BigNumber.from(t));try{return{receipt:await this.contractWrapper.sendTransaction("closeAuction",[q.BigNumber.from(t),r])}}catch(a){throw a.message.includes("cannot close auction before it has ended")?new Ir(t.toString(),e.endTimeInEpochSeconds.toString()):a}}async updateListing(t){return{receipt:await this.contractWrapper.sendTransaction("updateListing",[t.id,t.quantity,t.reservePrice,t.buyoutPrice,t.currencyContractAddress,t.startTimeInEpochSeconds,t.endTimeInEpochSeconds])}}async validateListing(t){try{return await this.getListing(t)}catch(r){throw console.error(`Error getting the listing with id ${t}`),r}}async mapListing(t){return{assetContractAddress:t.assetContract,buyoutPrice:q.BigNumber.from(t.buyoutPricePerToken),currencyContractAddress:t.currency,buyoutCurrencyValuePerToken:await U(this.contractWrapper.getProvider(),t.currency,t.buyoutPricePerToken),id:t.listingId.toString(),tokenId:t.tokenId,quantity:t.quantity,startTimeInEpochSeconds:t.startTime,asset:await Ut(t.assetContract,this.contractWrapper.getProvider(),t.tokenId,this.storage),reservePriceCurrencyValuePerToken:await U(this.contractWrapper.getProvider(),t.currency,t.reservePricePerToken),reservePrice:q.BigNumber.from(t.reservePricePerToken),endTimeInEpochSeconds:t.endTime,sellerAddress:t.tokenOwner,type:$.Auction}}};c(Yr,"MarketplaceAuction");var gn=require("@thirdweb-dev/contracts");var yn=require("ethers/lib/utils"),wn=require("@ethersproject/constants"),Le=class extends w{constructor(t,r,e){super(r,t,gn.TWRegistry__factory.abi,e)}async getContractAddresses(t){return(await this.readContract.getAll(t)).filter(r=>(0,yn.isAddress)(r)&&r.toLowerCase()!==wn.AddressZero)}};c(Le,"ContractRegistry");var kn=require("@thirdweb-dev/contracts"),de=require("ethers");var Cn=require("@thirdweb-dev/contracts");var F=class{constructor(t){this.contractWrapper=t}addListener(t,r){let e=this.contractWrapper.readContract.interface.getEvent(t);this.contractWrapper.readContract.on(e.name,(...a)=>{let n={};e.inputs.map(s=>s.name).forEach((s,i)=>{n[s]=a[i]}),r(n)})}removeListener(t,r){let e=this.contractWrapper.readContract.interface.getEvent(t);this.contractWrapper.readContract.off(e.name,r)}removeAllListeners(){this.contractWrapper.readContract.removeAllListeners()}};c(F,"ContractEvents");var X=class{constructor(t){this.contractWrapper=t}async get(){let[t,r]=await this.contractWrapper.readContract.getPlatformFeeInfo();return P.parse({platform_fee_recipient:t,platform_fee_basis_points:r})}async set(t){let r=P.parse(t);return{receipt:await this.contractWrapper.sendTransaction("setPlatformFeeInfo",[r.platform_fee_recipient,r.platform_fee_basis_points])}}};c(X,"ContractPlatformFee");var Xr=class extends Yt{constructor(t,r,e,a={},n=new w(t,r,Xr.contractFactory.abi,a)){super(n,e,a);this.metadata=new b(this.contractWrapper,Xr.schema,this.storage),this.roles=new N(this.contractWrapper,Xr.contractRoles),this.royalty=new rt(this.contractWrapper,this.metadata),this.primarySale=new it(this.contractWrapper),this.encoder=new E(this.contractWrapper),this.estimator=new I(this.contractWrapper),this.signature=new Kr(this.contractWrapper,this.roles,this.storage),this.events=new F(this.contractWrapper),this.platformFee=new X(this.contractWrapper)}async mint(t){return this.mintTo(await this.contractWrapper.getSignerAddress(),t)}async mintTo(t,r){let e=await _e(r,this.storage),a=await this.contractWrapper.sendTransaction("mintTo",[t,e]),n=this.contractWrapper.parseLogs("TokensMinted",a==null?void 0:a.logs);if(n.length===0)throw new Error("TokenMinted event not found");let s=n[0].args.tokenIdMinted;return{id:s,receipt:a,data:()=>this.get(s.toString())}}async mintBatch(t){return this.mintBatchTo(await this.contractWrapper.getSignerAddress(),t)}async mintBatchTo(t,r){let a=(await $t(r,this.storage)).map(i=>this.contractWrapper.readContract.interface.encodeFunctionData("mintTo",[t,i])),n=await this.contractWrapper.multiCall(a),s=this.contractWrapper.parseLogs("TokensMinted",n.logs);if(s.length===0||s.length<r.length)throw new Error("TokenMinted event not found, minting failed");return s.map(i=>{let p=i.args.tokenIdMinted;return{id:p,receipt:n,data:()=>this.get(p)}})}},K=Xr;c(K,"NFTCollection"),f(K,"contractType","nft-collection"),f(K,"contractRoles",["admin","minter","transfer"]),f(K,"contractFactory",Cn.TokenERC721__factory),f(K,"schema",Qo);var Sn=require("@thirdweb-dev/contracts");var Ue=require("ethers/lib/utils");var ja=require("ethers"),I=class{constructor(t){this.contractWrapper=t}async gasCostOf(t,r){let e=await this.contractWrapper.getPreferredGasPrice(),a=await this.contractWrapper.estimateGas(t,r);return ja.ethers.utils.formatEther(a.mul(e))}async currentGasPriceInGwei(){let t=await this.contractWrapper.getProvider().getGasPrice();return ja.ethers.utils.formatUnits(t,"gwei")}};c(I,"GasCostEstimator");var tr=class{constructor(t){this.contractWrapper=t}overrideNextTransaction(t){this.contractWrapper.withTransactionOverride(t)}};c(tr,"ContractInterceptor");var te=class extends Xt{constructor(t,r,e,a={},n=new w(t,r,te.contractFactory.abi,a)){super(n,e,a);this.metadata=new b(this.contractWrapper,te.schema,this.storage),this.roles=new N(this.contractWrapper,te.contractRoles),this.royalty=new rt(this.contractWrapper,this.metadata),this.primarySale=new it(this.contractWrapper),this.claimConditions=new Vr(this.contractWrapper,this.metadata,this.storage),this.history=new Gr(this.contractWrapper),this.encoder=new E(this.contractWrapper),this.events=new F(this.contractWrapper),this.estimator=new I(this.contractWrapper),this.platformFee=new X(this.contractWrapper),this.interceptor=new tr(this.contractWrapper)}async createBatch(t){var d;let r=await this.contractWrapper.readContract.nextTokenIdToMint(),e=await this.storage.uploadMetadataBatch(t.map(m=>nt.parse(m)),r.toNumber(),this.contractWrapper.readContract.address,await((d=this.contractWrapper.getSigner())==null?void 0:d.getAddress())),a=await this.contractWrapper.sendTransaction("lazyMint",[e.metadataUris.length,`${e.baseUri.endsWith("/")?e.baseUri:`${e.baseUri}/`}`]),n=this.contractWrapper.parseLogs("TokensLazyMinted",a==null?void 0:a.logs),s=n[0].args.startTokenId,i=n[0].args.endTokenId,p=[];for(let m=s;m.lte(i);m=m.add(1))p.push({id:m,receipt:a,data:()=>this.getTokenMetadata(m)});return p}async claimTo(t,r,e,a=[(0,Ue.hexZeroPad)([0],32)]){let n=await this.prepareClaim(r,e,a);return{receipt:await this.contractWrapper.sendTransaction("claim",[t,r,e,n.currencyAddress,n.price,n.proofs,n.maxQuantityPerTransaction],n.overrides)}}async claim(t,r,e=[(0,Ue.hexZeroPad)([0],32)]){let a=await this.contractWrapper.getSignerAddress();return this.claimTo(a,t,r,e)}async prepareClaim(t,r,e=[(0,Ue.hexZeroPad)([0],32)]){return Ee(r,await this.claimConditions.getActive(t),(await this.metadata.get()).merkle,this.contractWrapper,this.storage,e)}},_=te;c(_,"EditionDrop"),f(_,"contractType","edition-drop"),f(_,"contractRoles",["admin","minter","transfer"]),f(_,"contractFactory",Sn.DropERC1155__factory),f(_,"schema",$o);var Tn=require("@thirdweb-dev/contracts");var ee=require("ethers");var re=class extends Xt{constructor(t,r,e,a={},n=new w(t,r,re.contractFactory.abi,a)){super(n,e,a);this.metadata=new b(this.contractWrapper,re.schema,this.storage),this.roles=new N(this.contractWrapper,re.contractRoles),this.royalty=new rt(this.contractWrapper,this.metadata),this.primarySale=new it(this.contractWrapper),this.encoder=new E(this.contractWrapper),this.estimator=new I(this.contractWrapper),this.events=new F(this.contractWrapper),this.platformFee=new X(this.contractWrapper),this.signature=new Jr(this.contractWrapper,this.roles,this.storage)}async mint(t){return this.mintTo(await this.contractWrapper.getSignerAddress(),t)}async mintTo(t,r){let e=await _e(r.metadata,this.storage),a=await this.contractWrapper.sendTransaction("mintTo",[t,ee.ethers.constants.MaxUint256,e,r.supply]),n=this.contractWrapper.parseLogs("TokensMinted",a==null?void 0:a.logs);if(n.length===0)throw new Error("TokenMinted event not found");let s=n[0].args.tokenIdMinted;return{id:s,receipt:a,data:()=>this.get(s.toString())}}async mintAdditionalSupply(t,r){return this.mintAdditionalSupplyTo(await this.contractWrapper.getSignerAddress(),t,r)}async mintAdditionalSupplyTo(t,r,e){let a=await this.getTokenMetadata(r),n=await this.contractWrapper.sendTransaction("mintTo",[t,r,a.uri,e]);return{id:ee.BigNumber.from(r),receipt:n,data:()=>this.get(r)}}async mintBatch(t){return this.mintBatchTo(await this.contractWrapper.getSignerAddress(),t)}async mintBatchTo(t,r){let e=r.map(d=>d.metadata),a=r.map(d=>d.supply),s=(await $t(e,this.storage)).map((d,m)=>this.contractWrapper.readContract.interface.encodeFunctionData("mintTo",[t,ee.ethers.constants.MaxUint256,d,a[m]])),i=await this.contractWrapper.multiCall(s),p=this.contractWrapper.parseLogs("TokensMinted",i.logs);if(p.length===0||p.length<e.length)throw new Error("TokenMinted event not found, minting failed");return p.map(d=>{let m=d.args.tokenIdMinted;return{id:m,receipt:i,data:()=>this.get(m)}})}},J=re;c(J,"Edition"),f(J,"contractType","edition"),f(J,"contractRoles",["admin","minter","transfer"]),f(J,"contractFactory",Tn.TokenERC1155__factory),f(J,"schema",Xo);var Wn=require("@thirdweb-dev/contracts");var Ha=require("ethers");var ae=class extends Hr{constructor(t,r,e,a={},n=new w(t,r,ae.contractFactory.abi,a)){super(n,e,a);this.metadata=new b(this.contractWrapper,ae.schema,this.storage),this.roles=new N(this.contractWrapper,ae.contractRoles),this.history=new zr(this.contractWrapper),this.encoder=new E(this.contractWrapper),this.estimator=new I(this.contractWrapper),this.events=new F(this.contractWrapper),this.platformFee=new X(this.contractWrapper),this.signature=new qr(this.contractWrapper,this.roles)}async getVoteBalance(){return await this.getVoteBalanceOf(await this.contractWrapper.getSignerAddress())}async getVoteBalanceOf(t){return await this.getValue(await this.contractWrapper.readContract.getVotes(t))}async getDelegation(){return await this.getDelegationOf(await this.contractWrapper.getSignerAddress())}async getDelegationOf(t){return await this.contractWrapper.readContract.delegates(t)}async mint(t){return this.mintTo(await this.contractWrapper.getSignerAddress(),t)}async mintTo(t,r){let e=Ha.ethers.utils.parseUnits(B.parse(r),await this.contractWrapper.readContract.decimals());return{receipt:await this.contractWrapper.sendTransaction("mintTo",[t,e])}}async mintBatchTo(t){let r=[];for(let e of t){let a=Ha.ethers.utils.parseUnits(B.parse(e.amount),await this.contractWrapper.readContract.decimals());r.push(this.contractWrapper.readContract.interface.encodeFunctionData("mintTo",[e.toAddress,a]))}return{receipt:await this.contractWrapper.multiCall(r)}}async delegateTo(t){return{receipt:await this.contractWrapper.sendTransaction("delegate",[t])}}},V=ae;c(V,"Token"),f(V,"contractType","token"),f(V,"contractRoles",["admin","minter","transfer"]),f(V,"contractFactory",Wn.TokenERC20__factory),f(V,"schema",Ko);var Ve=require("@thirdweb-dev/contracts");var rr=require("ethers");var bn=tt(require("deep-equal"));var $e=class{constructor(t,r,e,a={},n=new w(t,r,$e.contractFactory.abi,a)){this.contractWrapper=n,this.storage=e,this.metadata=new b(this.contractWrapper,$e.schema,this.storage),this.encoder=new E(this.contractWrapper),this.estimator=new I(this.contractWrapper),this.events=new F(this.contractWrapper)}onNetworkUpdated(t){this.contractWrapper.updateSignerOrProvider(t)}getAddress(){return this.contractWrapper.readContract.address}async get(t){let e=(await this.getAll()).filter(a=>(0,bn.default)(rr.BigNumber.from(a.proposalId),rr.BigNumber.from(t)));if(e.length===0)throw new Error("proposal not found");return e[0]}async getAll(){return Promise.all((await this.contractWrapper.readContract.getAllProposals()).map(async t=>({proposalId:t.proposalId,proposer:t.proposer,description:t.description,startBlock:t.startBlock,endBlock:t.endBlock,state:await this.contractWrapper.readContract.state(t.proposalId),votes:await this.getProposalVotes(t.proposalId),executions:t[3].map((r,e)=>({toAddress:t.targets[e],nativeTokenValue:r,transactionData:t.calldatas[e]}))})))}async getProposalVotes(t){let r=await this.contractWrapper.readContract.proposalVotes(t);return[{type:qt.Against,label:"Against",count:r.againstVotes},{type:qt.For,label:"For",count:r.forVotes},{type:qt.Abstain,label:"Abstain",count:r.abstainVotes}]}async hasVoted(t,r){return r||(r=await this.contractWrapper.getSignerAddress()),this.contractWrapper.readContract.hasVoted(t,r)}async canExecute(t){await this.ensureExists(t);let r=await this.get(t),e=r.executions.map(i=>i.toAddress),a=r.executions.map(i=>i.nativeTokenValue),n=r.executions.map(i=>i.transactionData),s=rr.ethers.utils.id(r.description);try{return await this.contractWrapper.callStatic().execute(e,a,n,s),!0}catch{return!1}}async balance(){let t=await this.contractWrapper.readContract.provider.getBalance(this.contractWrapper.readContract.address);return{name:"",symbol:"",decimals:18,value:t,displayValue:rr.ethers.utils.formatUnits(t,18)}}async balanceOfToken(t){let r=Ve.IERC20__factory.connect(t,this.contractWrapper.getProvider());return await U(this.contractWrapper.getProvider(),t,await r.balanceOf(this.contractWrapper.readContract.address))}async ensureExists(t){try{await this.contractWrapper.readContract.state(t)}catch{throw Error(`Proposal ${t} not found`)}}async settings(){let[t,r,e,a,n]=await Promise.all([this.contractWrapper.readContract.votingDelay(),this.contractWrapper.readContract.votingPeriod(),this.contractWrapper.readContract.token(),this.contractWrapper.readContract.quorumNumerator(),this.contractWrapper.readContract.proposalThreshold()]),s=await Lt(this.contractWrapper.getProvider(),e);return{votingDelay:t.toString(),votingPeriod:r.toString(),votingTokenAddress:e,votingTokenMetadata:s,votingQuorumFraction:a.toString(),proposalTokenThreshold:n.toString()}}async propose(t,r){r||(r=[{toAddress:this.contractWrapper.readContract.address,nativeTokenValue:0,transactionData:"0x"}]);let e=r.map(p=>p.toAddress),a=r.map(p=>p.nativeTokenValue),n=r.map(p=>p.transactionData),s=await this.contractWrapper.sendTransaction("propose",[e,a,n,t]);return{id:this.contractWrapper.parseLogs("ProposalCreated",s==null?void 0:s.logs)[0].args.proposalId,receipt:s}}async vote(t,r,e=""){return await this.ensureExists(t),{receipt:await this.contractWrapper.sendTransaction("castVoteWithReason",[t,r,e])}}async execute(t){await this.ensureExists(t);let r=await this.get(t),e=r.executions.map(i=>i.toAddress),a=r.executions.map(i=>i.nativeTokenValue),n=r.executions.map(i=>i.transactionData),s=rr.ethers.utils.id(r.description);return{receipt:await this.contractWrapper.sendTransaction("execute",[e,a,n,s])}}},Q=$e;c(Q,"Vote"),f(Q,"contractType","vote"),f(Q,"contractFactory",Ve.VoteERC20__factory),f(Q,"schema",en);var je=require("@thirdweb-dev/contracts");var za=require("ethers");var Ge=class{constructor(t,r,e,a={},n=new w(t,r,Ge.contractFactory.abi,a)){this.contractWrapper=n,this.storage=e,this.metadata=new b(this.contractWrapper,Ge.schema,this.storage),this.encoder=new E(this.contractWrapper),this.estimator=new I(this.contractWrapper),this.events=new F(this.contractWrapper)}onNetworkUpdated(t){this.contractWrapper.updateSignerOrProvider(t)}getAddress(){return this.contractWrapper.readContract.address}async getAllRecipients(){let t=[],r=za.BigNumber.from(0),e=await this.contractWrapper.readContract.payeeCount();for(;r.lt(e);)try{let a=await this.contractWrapper.readContract.payee(r);t.push(await this.getRecipientSplitPercentage(a)),r=r.add(1)}catch(a){if("method"in a&&a.method.toLowerCase().includes("payee(uint256)"))break;throw a}return t}async balanceOfAllRecipients(){let t=await this.getAllRecipients(),r={};for(let e of t)r[e.address]=await this.balanceOf(e.address);return r}async balanceOfTokenAllRecipients(t){let r=await this.getAllRecipients(),e={};for(let a of r)e[a.address]=await this.balanceOfToken(a.address,t);return e}async balanceOf(t){let r=await this.contractWrapper.readContract.provider.getBalance(this.getAddress()),e=await this.contractWrapper.readContract["totalReleased()"](),a=r.add(e);return this._pendingPayment(t,a,await this.contractWrapper.readContract["released(address)"](t))}async balanceOfToken(t,r){let a=await je.IERC20__factory.connect(r,this.contractWrapper.getProvider()).balanceOf(this.getAddress()),n=await this.contractWrapper.readContract["totalReleased(address)"](r),s=a.add(n),i=await this._pendingPayment(t,s,await this.contractWrapper.readContract["released(address,address)"](r,t));return await U(this.contractWrapper.getProvider(),r,i)}async getRecipientSplitPercentage(t){let[r,e]=await Promise.all([this.contractWrapper.readContract.totalShares(),this.contractWrapper.readContract.shares(t)]);return{address:t,splitPercentage:e.mul(za.BigNumber.from(1e7)).div(r).toNumber()/1e5}}async withdraw(t){return{receipt:await this.contractWrapper.sendTransaction("release(address)",[t])}}async withdrawToken(t,r){return{receipt:await this.contractWrapper.sendTransaction("release(address,address)",[r,t])}}async distribute(){return{receipt:await this.contractWrapper.sendTransaction("distribute()",[])}}async distributeToken(t){return{receipt:await this.contractWrapper.sendTransaction("distribute(address)",[t])}}async _pendingPayment(t,r,e){return r.mul(await this.contractWrapper.readContract.shares(t)).div(await this.contractWrapper.readContract.totalShares()).sub(e)}},Y=Ge;c(Y,"Split"),f(Y,"contractType","split"),f(Y,"contractFactory",je.Split__factory),f(Y,"schema",Zo);var An=require("@thirdweb-dev/contracts");var er=require("ethers"),vn=tt(require("tiny-invariant"));var Tr=require("@ethersproject/constants");var oe=class{constructor(t,r,e,a={},n=new w(t,r,oe.contractFactory.abi,a)){this.contractWrapper=n,this.storage=e,this.metadata=new b(this.contractWrapper,oe.schema,this.storage),this.roles=new N(this.contractWrapper,oe.contractRoles),this.encoder=new E(this.contractWrapper),this.estimator=new I(this.contractWrapper),this.direct=new Qr(this.contractWrapper,this.storage),this.auction=new Yr(this.contractWrapper,this.storage),this.events=new F(this.contractWrapper),this.platformFee=new X(this.contractWrapper)}onNetworkUpdated(t){this.contractWrapper.updateSignerOrProvider(t)}getAddress(){return this.contractWrapper.readContract.address}async getListing(t){let r=await this.contractWrapper.readContract.listings(t);if(r.assetContract===Tr.AddressZero)throw new wt(this.getAddress(),t.toString());switch(r.listingType){case $.Auction:return await this.auction.mapListing(r);case $.Direct:return await this.direct.mapListing(r);default:throw new Error(`Unknown listing type: ${r.listingType}`)}}async getActiveListings(){return(await this.getAllListingsNoFilter()).filter(r=>r.type===$.Auction&&er.BigNumber.from(r.endTimeInEpochSeconds).gt(er.BigNumber.from(Math.floor(Date.now()/1e3)))||r.type===$.Direct&&r.quantity>0)}async getAllListings(t){let r=er.BigNumber.from((t==null?void 0:t.start)||0).toNumber(),e=er.BigNumber.from((t==null?void 0:t.count)||100).toNumber(),a=await this.getAllListingsNoFilter();return t&&(t.seller&&(a=a.filter(n=>{var s;return n.sellerAddress.toString().toLowerCase()===((s=t==null?void 0:t.seller)==null?void 0:s.toString().toLowerCase())})),t.tokenContract&&(t.tokenId?a=a.filter(n=>{var s,i;return n.assetContractAddress.toString().toLowerCase()===((s=t==null?void 0:t.tokenContract)==null?void 0:s.toString().toLowerCase())&&n.tokenId.toString()===((i=t==null?void 0:t.tokenId)==null?void 0:i.toString())}):a=a.filter(n=>{var s;return n.assetContractAddress.toString().toLowerCase()===((s=t==null?void 0:t.tokenContract)==null?void 0:s.toString().toLowerCase())})),a=a.filter((n,s)=>s>=r),a=a.slice(0,e)),a.filter(n=>n!==void 0)}getAll=this.getAllListings;async getTotalCount(){return await this.contractWrapper.readContract.totalListings()}async isRestrictedToListerRoleOnly(){return!await this.contractWrapper.readContract.hasRole(D("lister"),Tr.AddressZero)}async getBidBufferBps(){return this.contractWrapper.readContract.bidBufferBps()}async getTimeBufferInSeconds(){return this.contractWrapper.readContract.timeBuffer()}async buyoutListing(t,r,e){let a=await this.contractWrapper.readContract.listings(t);if(a.listingId.toString()!==t.toString())throw new wt(this.getAddress(),t.toString());switch(a.listingType){case $.Direct:return(0,vn.default)(r!==void 0,"quantityDesired is required when buying out a direct listing"),await this.direct.buyoutListing(t,r,e);case $.Auction:return await this.auction.buyoutListing(t);default:throw Error(`Unknown listing type: ${a.listingType}`)}}async setBidBufferBps(t){await this.roles.verify(["admin"],await this.contractWrapper.getSignerAddress());let r=await this.getTimeBufferInSeconds();await this.contractWrapper.sendTransaction("setAuctionBuffers",[r,er.BigNumber.from(t)])}async setTimeBufferInSeconds(t){await this.roles.verify(["admin"],await this.contractWrapper.getSignerAddress());let r=await this.getBidBufferBps();await this.contractWrapper.sendTransaction("setAuctionBuffers",[er.BigNumber.from(t),r])}async allowListingFromSpecificAssetOnly(t){let r=[];(await this.roles.get("asset")).includes(Tr.AddressZero)&&r.push(this.encoder.encode("revokeRole",[D("asset"),Tr.AddressZero])),r.push(this.encoder.encode("grantRole",[D("asset"),t])),await this.contractWrapper.multiCall(r)}async allowListingFromAnyAsset(){let t=[],r=await this.roles.get("asset");for(let e in r)t.push(this.encoder.encode("revokeRole",[D("asset"),e]));t.push(this.encoder.encode("grantRole",[D("asset"),Tr.AddressZero])),await this.contractWrapper.multiCall(t)}async getAllListingsNoFilter(){return(await Promise.all(Array.from(Array((await this.contractWrapper.readContract.totalListings()).toNumber()).keys()).map(async r=>{let e;try{e=await this.getListing(r)}catch{return}if(e.type===$.Auction)return e;if(!!await this.direct.isStillValidListing(e))return e}))).filter(r=>r!==void 0)}},G=oe;c(G,"Marketplace"),f(G,"contractType","marketplace"),f(G,"contractRoles",["admin","lister","asset"]),f(G,"contractFactory",An.Marketplace__factory),f(G,"schema",Go);var ar=require("@thirdweb-dev/contracts");var se=require("ethers");var ne=class{constructor(t,r,e,a={},n=new w(t,r,ne.contractFactory.abi,a)){this.contractWrapper=n,this.storage=e,this.metadata=new b(this.contractWrapper,ne.schema,this.storage),this.roles=new N(this.contractWrapper,ne.contractRoles),this.royalty=new rt(this.contractWrapper,this.metadata),this.encoder=new E(this.contractWrapper),this.estimator=new I(this.contractWrapper),this.events=new F(this.contractWrapper)}onNetworkUpdated(t){this.contractWrapper.updateSignerOrProvider(t)}getAddress(){return this.contractWrapper.readContract.address}async get(t){let[r,e,a]=await Promise.all([Ut(this.getAddress(),this.contractWrapper.getProvider(),t,this.storage),this.contractWrapper.readContract.packs(t),this.contractWrapper.readContract.totalSupply(t).catch(()=>se.BigNumber.from("0"))]);return{id:se.BigNumber.from(t).toString(),metadata:r,creator:e.creator,currentSupply:a,openStart:e.openStart.gt(0)?new Date(e.openStart.toNumber()*1e3):null}}async getAll(){let t=(await this.contractWrapper.readContract.nextTokenId()).toNumber();return await Promise.all(Array.from(Array(t).keys()).map(r=>this.get(r.toString())))}async getNFTs(t){let r=await this.contractWrapper.readContract.getPackWithRewards(t);if(!r.source)throw new ut;return(await Promise.all(r.tokenIds.map(a=>Ut(r.source,this.contractWrapper.getProvider(),a.toString(),this.storage)))).map((a,n)=>({supply:r.amountsPacked[n],metadata:a}))}async balanceOf(t,r){return await this.contractWrapper.readContract.balanceOf(t,r)}async balance(t){return await this.balanceOf(await this.contractWrapper.getSignerAddress(),t)}async isApproved(t,r){return await this.contractWrapper.readContract.isApprovedForAll(t,r)}async getLinkBalance(){let t=await this.contractWrapper.getChainID(),r=fr[t],e=ar.IERC20__factory.connect(r.linkTokenAddress,this.contractWrapper.getProvider());return await U(this.contractWrapper.getProvider(),r.linkTokenAddress,await e.balanceOf(this.getAddress()))}async getOwned(t){let r=t||await this.contractWrapper.getSignerAddress(),e=await this.contractWrapper.readContract.nextTokenId(),n=(await this.contractWrapper.readContract.balanceOfBatch(Array(e.toNumber()).fill(r),Array.from(Array(e.toNumber()).keys()))).map((s,i)=>({tokenId:i,balance:s})).filter(s=>s.balance.gt(0));return await Promise.all(n.map(async({tokenId:s,balance:i})=>{let p=await this.get(s.toString());return O(S({},p),{ownedByAddress:i})}))}async open(t){let r=await this.contractWrapper.sendTransaction("openPack",[t]),e=this.contractWrapper.parseLogs("PackOpenRequested",r==null?void 0:r.logs);if(e.length===0)throw new Error("Failed to open pack");let a=e[0],n=a.args.requestId,s=a.args.opener,i=await new Promise(m=>{this.contractWrapper.readContract.once(this.contractWrapper.readContract.filters.PackOpenFulfilled(null,s),(u,g,y,z,yt)=>{n===y&&m({packId:u,opener:g,requestId:n,rewardContract:z,rewardIds:yt})})}),{rewardIds:p,rewardContract:d}=i;return p.map(m=>({id:t,receipt:r,data:()=>Ut(d,this.contractWrapper.getProvider(),m.toString(),this.storage)}))}async create(t){let r=ar.IERC1155__factory.connect(t.assetContract,this.contractWrapper.getSigner()||this.contractWrapper.getProvider()),e=await this.contractWrapper.getSignerAddress(),a=t.assets.map(g=>g.tokenId),n=t.assets.map(g=>g.amount),s=await this.storage.uploadMetadata(t.metadata),i=se.ethers.utils.defaultAbiCoder.encode(["string","uint256","uint256"],[s,t.secondsUntilOpenStart||0,t.rewardsPerOpen||1]),d=await(await r.safeBatchTransferFrom(e,this.getAddress(),a,n,i,await this.contractWrapper.getCallOverrides())).wait(),m=this.contractWrapper.parseLogs("PackAdded",d.logs);if(m.length===0)throw new Error("PackCreated event not found");let u=m[0].args.packId;return{id:u,receipt:d,data:()=>this.get(u.toString())}}async transfer(t,r,e){return{receipt:await this.contractWrapper.sendTransaction("safeTransferFrom",[await this.contractWrapper.getSignerAddress(),t,r,e,[0]])}}async transferFrom(t,r,e,a=[0]){return{receipt:await this.contractWrapper.sendTransaction("safeTransferFrom",[t,r,e.tokenId,e.amount,a])}}async transferBatchFrom(t,r,e,a=[0]){let n=e.map(i=>i.tokenId),s=e.map(i=>i.amount);return{receipt:await this.contractWrapper.sendTransaction("safeBatchTransferFrom",[t,r,n,s,a])}}async setApproval(t,r=!0){return{receipt:await this.contractWrapper.sendTransaction("setApprovalForAll",[t,r])}}async depositLink(t){let r=await this.contractWrapper.getChainID(),e=fr[r];return{receipt:await(await ar.IERC20__factory.connect(e.linkTokenAddress,this.contractWrapper.getProvider()).transfer(this.getAddress(),t,await this.contractWrapper.getCallOverrides())).wait()}}},j=ne;c(j,"Pack"),f(j,"contractType","pack"),f(j,"contractRoles",["admin","minter","pauser","transfer"]),f(j,"contractFactory",ar.Pack__factory),f(j,"schema",Ho);var xn=require("@thirdweb-dev/contracts"),He=require("@ethersproject/bytes"),Gt=require("ethers");var Wr=require("ethers");var ie=class{constructor(t,r){this.contractWrapper=t,this.storage=r}async createDelayedRevealBatch(t,r,e){var yt,lt;if(!e)throw new Error("Password is required");let{baseUri:a}=await this.storage.uploadMetadataBatch([nt.parse(t)],0,this.contractWrapper.readContract.address,await((yt=this.contractWrapper.getSigner())==null?void 0:yt.getAddress())),n=await this.contractWrapper.readContract.nextTokenIdToMint(),s=await this.storage.uploadMetadataBatch(r.map(ct=>nt.parse(ct)),n.toNumber(),this.contractWrapper.readContract.address,await((lt=this.contractWrapper.getSigner())==null?void 0:lt.getAddress())),i=s.baseUri,p=await this.contractWrapper.readContract.getBaseURICount(),d=await this.contractWrapper.readContract.encryptDecrypt(Wr.ethers.utils.toUtf8Bytes(i.endsWith("/")?i:`${i}/`),await this.hashDelayRevealPasword(p,e)),m=await this.contractWrapper.sendTransaction("lazyMint",[s.metadataUris.length,a.endsWith("/")?a:`${a}/`,d]),u=this.contractWrapper.parseLogs("TokensLazyMinted",m==null?void 0:m.logs),g=u[0].args.startTokenId,y=u[0].args.endTokenId,z=[];for(let ct=g;ct.lte(y);ct=ct.add(1))z.push({id:ct,receipt:m});return z}async reveal(t,r){if(!r)throw new Error("Password is required");let e=await this.hashDelayRevealPasword(t,r);try{let a=await this.contractWrapper.callStatic().reveal(t,e);if(!a.includes("://")||!a.endsWith("/"))throw new Error("invalid password")}catch{throw new Error("invalid password")}return{receipt:await this.contractWrapper.sendTransaction("reveal",[t,e])}}async getBatchesToReveal(){let t=await this.contractWrapper.readContract.getBaseURICount();if(t.isZero())return[];let r=Array.from(Array(t.toNumber()).keys()),e=await Promise.all(r.map(p=>this.contractWrapper.readContract.baseURIIndices(p))),a=e.slice(0,e.length-1),n=await Promise.all(Array.from([0,...a]).map(p=>this.contractWrapper.readContract.tokenURI(p))),s=await Promise.all(Array.from([0,...a]).map(p=>this.getNftMetadata(p.toString()))),i=await Promise.all(Array.from([...e]).map(p=>this.contractWrapper.readContract.encryptedBaseURI(p)));return n.map((p,d)=>({batchId:Wr.BigNumber.from(d),batchUri:p,placeholderMetadata:s[d]})).filter((p,d)=>Wr.ethers.utils.hexDataLength(i[d])>0)}async hashDelayRevealPasword(t,r){let e=await this.contractWrapper.getChainID(),a=this.contractWrapper.readContract.address;return Wr.ethers.utils.solidityKeccak256(["string","uint256","uint256","address"],[r,e,t,a])}async getNftMetadata(t){let r=await this.contractWrapper.readContract.tokenURI(t);return Qt(t,r,this.storage)}};c(ie,"DelayedReveal");var ce=class extends Yt{constructor(t,r,e,a={},n=new w(t,r,ce.contractFactory.abi,a)){super(n,e,a);this.metadata=new b(this.contractWrapper,ce.schema,this.storage),this.roles=new N(this.contractWrapper,ce.contractRoles),this.royalty=new rt(this.contractWrapper,this.metadata),this.primarySale=new it(this.contractWrapper),this.claimConditions=new Ur(this.contractWrapper,this.metadata,this.storage),this.encoder=new E(this.contractWrapper),this.estimator=new I(this.contractWrapper),this.events=new F(this.contractWrapper),this.platformFee=new X(this.contractWrapper),this.revealer=new ie(this.contractWrapper,this.storage),this.interceptor=new tr(this.contractWrapper)}async getAllClaimed(t){let r=Gt.BigNumber.from((t==null?void 0:t.start)||0).toNumber(),e=Gt.BigNumber.from((t==null?void 0:t.count)||100).toNumber(),a=Math.min((await this.contractWrapper.readContract.nextTokenIdToClaim()).toNumber(),r+e);return await Promise.all(Array.from(Array(a).keys()).map(n=>this.get(n.toString())))}async getAllUnclaimed(t){let r=Gt.BigNumber.from((t==null?void 0:t.start)||0).toNumber(),e=Gt.BigNumber.from((t==null?void 0:t.count)||100).toNumber(),a=Gt.BigNumber.from(Math.min((await this.contractWrapper.readContract.nextTokenIdToMint()).toNumber(),r+e)),n=await this.contractWrapper.readContract.nextTokenIdToClaim();return await Promise.all(Array.from(Array(a.sub(n).toNumber()).keys()).map(s=>this.getTokenMetadata(n.add(s).toString())))}async totalClaimedSupply(){return await this.contractWrapper.readContract.nextTokenIdToClaim()}async totalUnclaimedSupply(){return(await this.contractWrapper.readContract.nextTokenIdToMint()).sub(await this.totalClaimedSupply())}async createBatch(t){var m;let r=await this.contractWrapper.readContract.nextTokenIdToMint(),e=await this.storage.uploadMetadataBatch(t.map(u=>nt.parse(u)),r.toNumber(),this.contractWrapper.readContract.address,await((m=this.contractWrapper.getSigner())==null?void 0:m.getAddress())),a=e.baseUri,n=await this.contractWrapper.sendTransaction("lazyMint",[e.metadataUris.length,a.endsWith("/")?a:`${a}/`,Gt.ethers.utils.toUtf8Bytes("")]),s=this.contractWrapper.parseLogs("TokensLazyMinted",n==null?void 0:n.logs),i=s[0].args.startTokenId,p=s[0].args.endTokenId,d=[];for(let u=i;u.lte(p);u=u.add(1))d.push({id:u,receipt:n,data:()=>this.getTokenMetadata(u)});return d}async claimTo(t,r,e=[(0,He.hexZeroPad)([0],32)]){let a=await this.prepareClaim(r,e),n=await this.contractWrapper.sendTransaction("claim",[t,r,a.currencyAddress,a.price,a.proofs,a.maxQuantityPerTransaction],a.overrides),i=this.contractWrapper.parseLogs("TokensClaimed",n==null?void 0:n.logs)[0].args.startTokenId,p=i.add(r),d=[];for(let m=i;m.lt(p);m=m.add(1))d.push({id:m,receipt:n,data:()=>this.get(m)});return d}async claim(t,r=[(0,He.hexZeroPad)([0],32)]){return this.claimTo(await this.contractWrapper.getSignerAddress(),t,r)}async prepareClaim(t,r=[(0,He.hexZeroPad)([0],32)]){return Ee(t,await this.claimConditions.getActive(),(await this.metadata.get()).merkle,this.contractWrapper,this.storage,r)}},H=ce;c(H,"NFTDrop"),f(H,"contractType","nft-drop"),f(H,"contractRoles",["admin","minter","transfer"]),f(H,"contractFactory",xn.DropERC721__factory),f(H,"schema",Lo);var pe={[H.contractType]:H,[K.contractType]:K,[_.contractType]:_,[J.contractType]:J,[V.contractType]:V,[Q.contractType]:Q,[Y.contractType]:Y,[G.contractType]:G,[j.contractType]:j},Za={[H.contractType]:"DropERC721",[K.contractType]:"TokenERC721",[_.contractType]:"DropERC1155",[J.contractType]:"TokenERC1155",[V.contractType]:"TokenERC20",[Q.contractType]:"VoteERC20",[Y.contractType]:"Split",[G.contractType]:"Marketplace",[j.contractType]:"Pack"},ze={DropERC721:H.contractType,TokenERC721:K.contractType,DropERC1155:_.contractType,TokenERC1155:J.contractType,TokenERC20:V.contractType,VoteERC20:Q.contractType,Split:Y.contractType,Marketplace:G.contractType,Pack:j.contractType};var At=require("@thirdweb-dev/contracts");var Pn=v.merge(x.merge(Ct).merge(L).partial()),Ds=k.merge(x.merge(Ct).merge(L).partial()),Ns=Pn.merge(P.merge(st).merge(R).partial()),En={deploy:Ns,output:Ds,input:Pn};function br(o,t){return Bs(o.readContract,t)}c(br,"implementsInterface");function Bs(o,t){let r=o.interface.functions,e=t.functions;return Object.keys(r).filter(a=>a in e).length===Object.keys(e).length}c(Bs,"matchesInterface");var Ze=class{constructor(t,r,e,a,n={},s=new w(t,r,e,n)){this.storage=a,this.contractWrapper=s,this.metadata=this.detectMetadata(),this.royalties=this.detectRoyalties(),this.roles=this.detectRoles(),this.sales=this.detectPrimarySales(),this.platformFees=this.detectPlatformFees()}onNetworkUpdated(t){this.contractWrapper.updateSignerOrProvider(t)}getAddress(){return this.contractWrapper.readContract.address}detectMetadata(){if(br(this.contractWrapper,At.IThirdwebContract__factory.createInterface()))return new b(this.contractWrapper,Ze.schema,this.storage)}detectRoyalties(){if(br(this.contractWrapper,At.IThirdwebRoyalty__factory.createInterface())){let t=new b(this.contractWrapper,Ze.schema,this.storage);return new rt(this.contractWrapper,t)}}detectRoles(){if(br(this.contractWrapper,At.AccessControlEnumerable__factory.createInterface()))return new N(this.contractWrapper,Xe)}detectPrimarySales(){if(br(this.contractWrapper,At.IThirdwebPrimarySale__factory.createInterface()))return new it(this.contractWrapper)}detectPlatformFees(){if(br(this.contractWrapper,At.IThirdwebPlatformFee__factory.createInterface()))return new X(this.contractWrapper)}},or=Ze;c(or,"CustomContract"),f(or,"contractType","custom"),f(or,"schema",En);var qa=require("@ethersproject/constants"),qe=class extends w{constructor(t,r,e,a){super(r,t,kn.TWFactory__factory.abi,a);this.storage=e}async deploy(t,r){var g;let e=pe[t],a=e.schema.deploy.parse(r),n=e.contractFactory,s=await this.storage.uploadMetadata(a,this.readContract.address,await((g=this.getSigner())==null?void 0:g.getAddress())),i=n.getInterface(n.abi).encodeFunctionData("initialize",await this.getDeployArguments(t,a,s)),p=Za[t];console.log(`Remote contractName : ${p}`);let d=de.ethers.utils.formatBytes32String(p);console.log(`Deploying ${t} proxy`);let m=await this.sendTransaction("deployProxy",[d,i]);console.log(`${t} proxy deployed successfully`);let u=this.parseLogs("ProxyDeployed",m.logs);if(u.length<1)throw new Error("No ProxyDeployed event found");return u[0].args.proxy}async getDeployArguments(t,r,e){let a=await this.getDefaultTrustedForwarders();switch(r.trusted_forwarders&&r.trusted_forwarders.length>0&&(a=r.trusted_forwarders),t){case H.contractType:case K.contractType:let n=H.schema.deploy.parse(r);return[await this.getSignerAddress(),n.name,n.symbol,e,a,n.primary_sale_recipient,n.fee_recipient,n.seller_fee_basis_points,n.platform_fee_basis_points,n.platform_fee_recipient];case _.contractType:case J.contractType:let s=_.schema.deploy.parse(r);return[await this.getSignerAddress(),s.name,s.symbol,e,a,s.primary_sale_recipient,s.fee_recipient,s.seller_fee_basis_points,s.platform_fee_basis_points,s.platform_fee_recipient];case V.contractType:let i=V.schema.deploy.parse(r);return[await this.getSignerAddress(),i.name,i.symbol,e,a,i.primary_sale_recipient,i.platform_fee_recipient,i.platform_fee_basis_points];case Q.contractType:let p=Q.schema.deploy.parse(r);return[p.name,e,a,p.voting_token_address,p.voting_delay_in_blocks,p.voting_period_in_blocks,de.BigNumber.from(p.proposal_token_threshold),p.voting_quorum_fraction];case Y.contractType:let d=Y.schema.deploy.parse(r);return[await this.getSignerAddress(),e,a,d.recipients.map(y=>y.address),d.recipients.map(y=>de.BigNumber.from(y.sharesBps))];case G.contractType:let m=G.schema.deploy.parse(r);return[await this.getSignerAddress(),e,a,m.platform_fee_recipient,m.platform_fee_basis_points];case j.contractType:let u=j.schema.deploy.parse(r),g=fr[await this.getChainID()];return[await this.getSignerAddress(),u.name,u.symbol,e,a,u.fee_recipient,u.seller_fee_basis_points,g.fees,g.keyHash];default:return[]}}async getDefaultTrustedForwarders(){let t=await this.getChainID(),r=ma.find(a=>a===t),e=r?be[r].biconomyForwarder:qa.AddressZero;return e!==qa.AddressZero?[dr,e]:[dr]}};c(qe,"ContractFactory");var me=class extends Nt{constructor(t,r,e){super(t,r);this.storage=e}async deployNFTCollection(t){return await this.deployContract(K.contractType,t)}async deployNFTDrop(t){return await this.deployContract(H.contractType,t)}async deployEdition(t){return await this.deployContract(J.contractType,t)}async deployEditionDrop(t){let r=_.schema.deploy.parse(t);return await this.deployContract(_.contractType,r)}async deployToken(t){return await this.deployContract(V.contractType,t)}async deployMarketplace(t){return await this.deployContract(G.contractType,t)}async deployPack(t){return await this.deployContract(j.contractType,t)}async deploySplit(t){return await this.deployContract(Y.contractType,t)}async deployVote(t){return await this.deployContract(Q.contractType,t)}async deployContract(t,r){return await(await this.getFactory()).deploy(t,r)}async getRegistry(){if(this._registry)return this._registry;let t=(await this.getProvider().getNetwork()).chainId,r=mr(t,"twRegistry");return this._registry=Promise.resolve(new Le(r,this.getProvider(),this.options))}async getFactory(){if(this._factory)return this._factory;let t=(await this.getProvider().getNetwork()).chainId,r=mr(t,"twFactory");return this._factory=Promise.resolve(new qe(r,this.getSignerOrProvider(),this.storage,this.options))}updateSignerOrProvider(t){super.updateSignerOrProvider(t),this.updateContractSignerOrProvider()}updateContractSignerOrProvider(){var t,r;(t=this._factory)==null||t.then(e=>{e.updateSignerOrProvider(this.getSignerOrProvider())}),(r=this._registry)==null||r.then(e=>{e.updateSignerOrProvider(this.getSignerOrProvider())})}};c(me,"ContractDeployer");var Rn=require("ethers");function Ka(o,t){let r=Object.keys(o);for(let e in r){let a=o[r[e]],n=a instanceof File||a instanceof Buffer;if(typeof a=="object"&&!n){Ka(a,t);continue}!n||(o[r[e]]=`ipfs://${t.splice(0,1)[0]}`)}return o}c(Ka,"replaceFilePropertiesWithHashes");function Ke(o,t,r){let e=Object.keys(o);for(let a in e){let n=o[e[a]];o[e[a]]=Je(n,t,r),Array.isArray(n)&&(o[e[a]]=n.map(s=>typeof s=="object"?Ke(s,t,r):Je(s,t,r))),typeof n=="object"&&Ke(n,t,r)}return o}c(Ke,"replaceHashWithGatewayUrl");function Je(o,t,r){return typeof o=="string"&&o&&o.toLowerCase().includes(t)?o.replace(t,r):o}c(Je,"resolveGatewayUrl");globalThis.FormData||(globalThis.FormData=require("form-data"));var le=class{constructor(t=Pa){this.gatewayUrl=`${t.replace(/\/$/,"")}/`}async upload(t,r,e){return`${await this.uploadBatch([t],0,r,e)}0`}async uploadBatch(t,r=0,e,a){let{cid:n}=await this.uploadBatchWithCid(t,r,e,a);return`ipfs://${n}/`}async getUploadToken(t){let r={"X-App-Name":`CONSOLE-TS-SDK-${t}`},e=await fetch(`${Ea}/grant`,{method:"GET",headers:r});if(!e.ok)throw new kr("Failed to get upload token");return await e.text()}async get(t){let e=await(await this._get(t)).json();return Ke(e,"ipfs://",this.gatewayUrl)}async uploadMetadata(t,r,e){let{metadataUris:a}=await this.uploadMetadataBatch([t],0,r,e);return a[0]}async uploadMetadataBatch(t,r,e,a){let n=(await this.batchUploadProperties(t)).map(m=>JSON.stringify(m)),{cid:s,fileNames:i}=await this.uploadBatchWithCid(n,r,e,a),p=`ipfs://${s}/`,d=i.map(m=>`${p}${m}`);return{baseUri:p,metadataUris:d}}async _get(t){let r=t;t&&(r=Je(t,"ipfs://",this.gatewayUrl));let e=await fetch(r);if(!e.ok)throw new Error(`Status code (!= 200) =${e.status}`);return e}async batchUploadProperties(t){let r=t.flatMap(i=>this.buildFilePropertiesMap(i,[]));if(r.length===0)return t;let{cid:e,fileNames:a}=await this.uploadBatchWithCid(r),n=[];for(let i of a)n.push(`${e}/${i}`);return await Ka(t,n)}buildFilePropertiesMap(t,r=[]){if(Array.isArray(t))t.forEach(e=>{this.buildFilePropertiesMap(e,r)});else if(t){let e=Object.values(t);for(let a of e)a instanceof File||a instanceof Buffer?r.push(a):typeof a=="object"&&this.buildFilePropertiesMap(a,r)}return r}async uploadBatchWithCid(t,r=0,e,a){let n=await this.getUploadToken(e||""),s={name:`CONSOLE-TS-SDK-${e}`,keyvalues:{sdk:"typescript",contractAddress:e,signerAddress:a}},i=new FormData,p=[];t.forEach((u,g)=>{let y="",z=u;if(u instanceof File){let lt="";if(u.name){let ct=u.name.lastIndexOf(".");ct>-1&&(lt=u.name.substring(ct))}y=`${g+r}${lt}`}else u instanceof Buffer||typeof u=="string"?y=`${g+r}`:u&&u.name&&(u==null?void 0:u.data)?(z=u==null?void 0:u.data,y=`${u.name}`):y=`${g+r}`;let yt=`files/${y}`;if(p.indexOf(y)>-1)throw new Er(y);p.push(y),typeof window>"u"?i.append("file",z,{filepath:yt}):i.append("file",new Blob([z]),yt)}),i.append("pinataMetadata",JSON.stringify(s));let d=await fetch(ka,{method:"POST",headers:{Authorization:`Bearer ${n}`},body:i}),m=await d.json();if(!d.ok)throw console.log(m),new Pr("Failed to upload files to IPFS");return{cid:m.IpfsHash,fileNames:p}}};c(le,"IpfsStorage");var Fn=require("@thirdweb-dev/contracts");var In=tt(require("tiny-invariant")),Ja=class extends Nt{contractCache=new Map;constructor(t,r={},e=new le){super(t,r);this.storage=e,this.deployer=new me(t,r,e)}getNFTDrop(t){return this.getContract(t,H.contractType)}getNFTCollection(t){return this.getContract(t,K.contractType)}getEditionDrop(t){return this.getContract(t,_.contractType)}getEdition(t){return this.getContract(t,J.contractType)}getToken(t){return this.getContract(t,V.contractType)}getVote(t){return this.getContract(t,Q.contractType)}getSplit(t){return this.getContract(t,Y.contractType)}getMarketplace(t){return this.getContract(t,G.contractType)}getPack(t){return this.getContract(t,j.contractType)}getContract(t,r){if(this.contractCache.has(t))return this.contractCache.get(t);let e=new pe[r](this.getSignerOrProvider(),t,this.storage,this.options);return this.contractCache.set(t,e),e}async resolveContractType(t){let r=Fn.IThirdwebContract__factory.connect(t,this.getSignerOrProvider()),e=Rn.ethers.utils.toUtf8String(await r.contractType()).replace(/\x00/g,"");return(0,In.default)(e in ze,`${e} is not a valid contract type, falling back to custom contract`),ze[e]}async getContractList(t){let r=await(await this.deployer.getRegistry()).getContractAddresses(t);return(await Promise.all(r.map(async a=>({address:a,contractType:await this.resolveContractType(a).catch(n=>(console.error(`failed to get contract type for address: ${a}`,n),""))})))).map(({address:a,contractType:n})=>({address:a,contractType:n,metadata:()=>this.getContract(a,n).metadata.get()}))}updateSignerOrProvider(t){super.updateSignerOrProvider(t),this.updateContractSignerOrProvider()}updateContractSignerOrProvider(){this.deployer.updateSignerOrProvider(this.getSignerOrProvider());for(let[,t]of this.contractCache)t.onNetworkUpdated(this.getSignerOrProvider())}async unstable_getCustomContract(t,r){return new or(this.getSignerOrProvider(),t,r,this.storage,this.options)}};c(Ja,"ThirdwebSDK");0&&(module.exports={ALL_ROLES,AdminRoleMissingError,AssetNotFoundError,AuctionAlreadyStartedError,AuctionHasNotEndedError,BaseSignaturePayloadInput,CONTRACTS_MAP,CONTRACT_ADDRESSES,ChainId,ChainlinkVrf,ClaimConditionInputArray,ClaimConditionInputSchema,ClaimConditionOutputSchema,ClaimEligibility,CommonContractOutputSchema,CommonContractSchema,CommonPlatformFeeSchema,CommonPrimarySaleSchema,CommonRoyaltySchema,CommonSymbolSchema,CommonTrustedForwarderSchema,ContractDeployer,ContractEncoder,ContractEvents,ContractInterceptor,ContractMetadata,ContractPrimarySale,ContractRoles,ContractRoyalty,CurrencySchema,CurrencyValueSchema,CustomContract,DEFAULT_IPFS_GATEWAY,DEFAULT_QUERY_ALL_COUNT,DelayedReveal,DropErc1155ClaimConditions,DropErc1155History,DropErc721ClaimConditions,DuplicateFileNameError,DuplicateLeafsError,Edition,EditionDrop,EditionMetadataInputOrUriSchema,EditionMetadataInputSchema,EditionMetadataOutputSchema,EditionMetadataWithOwnerOutputSchema,Erc1155,Erc1155SignatureMinting,Erc20,Erc20SignatureMinting,Erc721,Erc721SignatureMinting,EventType,FetchError,FileNameMissingError,FunctionDeprecatedError,GasCostEstimator,InterfaceId_IERC1155,InterfaceId_IERC721,InvalidAddressError,IpfsStorage,ListingNotFoundError,ListingType,Marketplace,MarketplaceAuction,MarketplaceDirect,MerkleSchema,MintRequest1155,MintRequest20,MintRequest721,MissingOwnerRoleError,MissingRoleError,NATIVE_TOKENS,NATIVE_TOKEN_ADDRESS,NFTCollection,NFTDrop,NotEnoughTokensError,NotFoundError,OZ_DEFENDER_FORWARDER_ADDRESS,OptionalPropertiesInput,OptionalPropertiesOutput,PINATA_IPFS_URL,Pack,PartialClaimConditionInputSchema,ProposalState,QuantityAboveLimitError,REMOTE_CONTRACT_NAME,REMOTE_CONTRACT_TO_CONTRACT_TYPE,RestrictedTransferError,SUPPORTED_CHAIN_IDS,Signature1155PayloadInput,Signature1155PayloadOutput,Signature20PayloadInput,Signature20PayloadOutput,Signature721PayloadInput,Signature721PayloadOutput,SnapshotAddress,SnapshotInfoSchema,SnapshotInputSchema,SnapshotSchema,Split,TW_IPFS_SERVER_URL,ThirdwebSDK,Token,TokenERC20History,TokenMintInputSchema,TransactionError,UnderlyingType,UploadError,Vote,VoteType,WrongListingTypeError,convertToTWError,createSnapshot,getContractAddressByChainId,getNativeTokenByChainId,getRoleHash,hashLeafNode});
//# sourceMappingURL=index.js.map